(this.webpackJsonparena=this.webpackJsonparena||[]).push([[0],{145:function(e,t,n){e.exports=n(254)},150:function(e,t,n){},165:function(e,t){},167:function(e,t){},203:function(e,t){},204:function(e,t){},246:function(e,t,n){e.exports=n.p+"static/media/user-icon.bdeaa261.svg"},247:function(e,t,n){e.exports=n.p+"static/media/login.9f370677.svg"},249:function(e,t,n){},250:function(e,t,n){e.exports=n.p+"static/media/logo-est.bca08fff.png"},251:function(e,t,n){e.exports=n.p+"static/media/tara-logo-et.5947b56d.png"},253:function(e,t,n){e.exports=n.p+"static/media/arena-logo.03f46566.png"},254:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(29),i=n.n(c),s=(n(150),n(19)),o=(n(90),n(141)),l=n(40),u=n(2),m=n(3),d=n(5),p=n(6),v=n(7),f=n(8),h=n(49);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y="Process/SEND_MESSAGE",E={};function O(e,t){var n=new t;return function(e,t,n){void 0===E[e]&&(E[e]={}),E[e][t]=n}(e,n.name,(function(e,t){return n.handle(e,t)})),function(e){return function(t){return n.createMessage(g({},void 0===t?{}:t,{},void 0===e?{}:e))}}}function j(e,t,n,a){return{type:y,arena:e,sender:t.name,receivers:0===n.length?[t.name]:n,message:a}}var N=function(){function e(){Object(u.a)(this,e),this.name=void 0}return Object(m.a)(e,[{key:"createMessage",value:function(e){return g({},e,{type:this.name})}},{key:"handle",value:function(e,t){return g({},e,{mem:this.updateMem(e.mem,t)})}},{key:"updateMem",value:function(e,t){return e}},{key:"send",value:function(e,t){return g({},e,{queue:e.queue.concat(t)})}},{key:"withResponse",value:function(e,t,n){return this.send(e,j(t.arena,e,[t.sender],n))}},{key:"withErrorResponse",value:function(e,t,n,a){return this.withResponse(e,t,g({type:"error",error:n},a))}},{key:"withOkResponse",value:function(e,t){return this.withResponse(e,t,{type:"ack",response:"OK"})}}]),e}(),w={};var k=function(e){var t=e.process;return JSON.stringify(t.mem)},D={};function I(e,t,n){void 0===D[e]&&(D[e]={}),D[e][t]=n}function C(e,t){return function(e,t){return g({},e,{mem:g({},e.mem,{},t)})}(e,{db:g({},e.mem.db,{},t)})}function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{byName:{},allNames:[]},t=arguments.length>1?arguments[1]:void 0;return{byName:P({},e.byName,Object(f.a)({},t.name,t)),allNames:e.allNames.filter((function(e){return e!==t.name})).concat(t.name)}}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{byName:{},allNames:[]},t=arguments.length>1?arguments[1]:void 0;return P({},e,{byName:Object.assign.apply(Object,[{}].concat(Object(h.a)(e.allNames.map((function(n){return Object(f.a)({},n,t(e.byName[n]))})))))})}function A(e){return e.reduce(R,{byName:{},allNames:[]})}function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var U=300,M=R,V=T;var F="Arena/CREATE_PROCESS",q="Arena/FLUSH_QUEUE";function L(e,t){if(t.arena!==e.name)return e;switch(t.type){case F:return _({},e,{process:M(e.process,t.process)});case q:return _({},e,{process:V(e.process,(function(e){return _({},e,{queue:[]})}))});case y:return _({},e,{process:V(e.process,(function(e){return function(e,t){return t.type===y&&t.receivers.includes(e.name)?void 0===E[e.type]?(console.error("No handler for ".concat(e.name," (").concat(e.type,")")),e):void 0===E[e.type][t.message.type]?(console.error("No handler for ".concat(e.name," (").concat(e.type,") for message ").concat(t.message.type," (").concat(JSON.stringify(t.message),")")),e):E[e.type][t.message.type](e,t):e}(e,t)})),log:e.log.concat([t])});default:return e}}function B(e){return _({},e,{now:Date.now()/1e3|0,random:""+Math.random()})}function H(e){var t=function(e){return e.allNames.map((function(t){return(n=e.byName[t].process).allNames.map((function(e){return n.byName[e].queue})).flat(1).filter((function(e){return void 0!==e}));var n})).flat(1)}(e.getState().theatre.arenas);if(0!==t.length){Object.keys(Object.assign.apply(Object,[{}].concat(Object(h.a)(t.map((function(e){return Object(f.a)({},e.arena,1)})))))).forEach((function(t){return e.dispatch({type:q,arena:t})}));window.setTimeout((function(){!function e(t,n){n.length>0&&(t.dispatch(B(n.shift())),window.setTimeout((function(){e(t,n)}),U))}(e,t)}),U)}}var z=n(41),K=n(127),J=n(128),G=n(20);console.log("i18n init"),z.a.use(K.a).use(J.a).use(G.b).init({fallbackLng:"et",debug:!1,backend:{loadPath:(window.location.pathname.includes("/ui/")?"../../":"")+"locales/{{lng}}/{{ns}}.json"},whitelist:["et","en"],nonExplicitWhitelist:!0,interpolation:{escapeValue:!1}});z.a;function W(e,t,n){var a=t.join("."),r=e.arena,c=e.process.name,i=e.process.type;return z.a.t([[r,c],[r,i],[i],[]].map((function(e){return e.concat(a).join(".")})),n)}function Q(e,t,n){return W({arena:e,process:{name:t,type:n}},["stylename"])}function $(e){return function(e,t){return z.a.t(["person.".concat(e,".").concat(t),"person.default.".concat(t)]).replace("ISIKUKOOD",e)}(e,"name")}function X(e,t){return z.a.t("business.".concat(e,".").concat(t))}function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Z(e,t){return r.a.createElement("span",{className:"msg-".concat(Q(e,t))},t)}function ee(e){return new Date(1e3*e).toLocaleString("se")}function te(e,t,n){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{onClick:function(t){return n(e)}},r.a.createElement("span",{className:"link-underline"},ee(e.now)),"\xa0"),Z(e.arena,e.sender),r.a.createElement("span",null," \xbb "),(a=e.arena,1===(c=e.receivers).length?Z(a,c[0]):r.a.createElement(r.a.Fragment,null,"(",c.map((function(e,t){return r.a.createElement(r.a.Fragment,null,0===t?", ":void 0,Z(a,e))})),")")));var a,c}function ne(e){return"".concat(e.type,": ").concat(JSON.stringify(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{type:void 0,statusUpdateChannel:void 0}),(t=40,function(e,n){return"string"!==typeof n?n:n.length>t?n.substring(0,t)+"...":n}),"  "));var t}function ae(e,t,n){return r.a.createElement(r.a.Fragment,null,te(e,0,n),":",r.a.createElement("br",null),ne(e.message))}function re(e,t,n,a,c){return r.a.createElement("span",null,function(e){if(void 0===ce[e.arena])return ae;if(void 0===ce[e.arena][e.message.type])return ae;return ce[e.arena][e.message.type]}(n)(n,a,c))}var ce={};function ie(e,t){Object.keys(t).forEach((function(n){return function(e,t,n){void 0===ce[e]&&(ce[e]={}),ce[e][t]=n}(e,n,t[n])}))}var se={},oe="ClientIS",le="loginView",ue=n(12),me=n(256),de=n(136),pe=n(257);function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function fe(e){return"string"===typeof e&&e.startsWith("{")?JSON.parse(e):e}function he(e){return void 0===e||null===e?{}:Array.from(e.elements).map((function(t,n){return e.elements[n]})).filter((function(e){return void 0!==e.name&&null!==e.name&&""!==e.name&&!e.name.startsWith("_")})).map((function(e){if("select-multiple"===e.type){var t,n=[];for(t=0;t<e.options.length;t++)e.options[t].selected&&n.push(fe(e.options[t].value));return Object(f.a)({},e.name,n)}if("checkbox"===e.type){var a=e.value.split("|",2);return 1===a.length&&a.push(void 0),Object(f.a)({},e.name,fe(a[e.checked?0:1]))}return Object(f.a)({},e.name,fe(e.value))})).reduce((function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{},t)}),{})}var be=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handleClick",value:function(e){e.preventDefault(),this.props.messageToAction(this.props,he(e.currentTarget.form)),this.props.onClick&&this.props.onClick(e)}},{key:"render",value:function(){var e=this;return a.createElement("button",{className:void 0===this.props.className?"btn btn-primary":this.props.className,onClick:function(t){return e.handleClick(t)},title:this.props.title},this.props.text)}}]),t}(a.Component),ge=Object(s.b)(null,{messageToAction:function(e,t){return B(j(e.arena,e.owner,(n=e.owner,void 0!==(a=e.target)&&"string"===typeof a?[a]:void 0===a||0===a.length?[n.name]:a),e.message(t)));var n,a}})(be),ye="ConsentService",Ee="loginView";function Oe(e,t){return e.find((function(e){return 0===Object.keys(t).filter((function(n){return e[n]!==t[n]})).length}))}var je=n(132);function Ne(e){return Object(je.createHash)("sha256").update(e).digest("hex").substring(0,6)}function we(e){var t=e.match("^([^/]+/[^/]+/[^/]+)(/.*)?$");return null===t?e:t[1]}function ke(e){return new Date(e).valueOf()/1e3}function De(e){var t=[];function n(e){return e[e.length-1]}return t.push({text:"",indent:-1,children:[]}),e.split("\n").forEach((function(e){var a=e.match("^((  )+\\* )(.*)$");null===a&&(a=["","","",e]);for(var r=a[1],c=a[3];r.length<=n(t).indent;)t.pop();r.length>n(t).indent&&(n(t).children.push({text:c,indent:r.length,children:[]}),t.push(n(n(t).children)))})),t[0].children.map((function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"desc-markup"},e.text),function e(t){return 0===t.length?r.a.createElement(r.a.Fragment,null):r.a.createElement("ul",{className:"desc-markup"},t.map((function(t){return r.a.createElement("li",{className:"desc-markup"},t.text,e(t.children))})))}(e.children))}))}function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Se=O(ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/addServiceDeclaration",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"addServiceDeclaration",value:function(e,t){return C(e,{serviceDeclarations:e.mem.db.serviceDeclarations.concat(t)})}},{key:"handle",value:function(e,t){console.log("addServiceDeclaration: ".concat(JSON.stringify(t)));var n=t.message;return void 0!==Oe(e.mem.db.serviceDeclarations,{serviceProviderId:n.serviceProviderId,serviceDeclarationId:n.serviceDeclarationId})?this.withErrorResponse(e,t,"duplicate_declaration"):n.serviceProviderId!==we(t.sender)?this.withErrorResponse(e,t,"invalid_request",{msg:"serviceProvcderId in declaration and message do not match"}):void 0!==n.serviceDeclarationId&&n.serviceDeclarationId.match("^[!-~]+$")?this.withOkResponse(this.addServiceDeclaration(e,Ce({},t.message,{type:void 0})),t):this.withErrorResponse(e,t,"invalid_request",{msg:"Invalid service declaration id"})}}]),t}(N)),Pe=O(ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/addPurposeDeclaration",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"addPurposeDeclaration",value:function(e,t){return C(e,{purposeDeclarations:e.mem.db.purposeDeclarations.concat(t)})}},{key:"handle",value:function(e,t){console.log("addPurposeDeclaration: ".concat(JSON.stringify(t)));var n=t.message;return void 0!==Oe(e.mem.db.purposeDeclarations,{clientId:n.clientId,purposeDeclarationId:n.purposeDeclarationId})?this.withErrorResponse(e,t,"duplicate_declaration"):n.clientId!==we(t.sender)?this.withErrorResponse(e,t,"invalid_request",{msg:"clientId in declaration and message do not match"}):void 0!==n.purposeDeclarationId&&n.purposeDeclarationId.match("^[!-~]+$")?0===n.services.length||void 0!==n.services.find((function(t){return void 0===Oe(e.mem.db.serviceDeclarations,t)}))?this.withErrorResponse(e,t,"invalid_request",{msg:"Invalid or missing SD reference(s)"}):this.withOkResponse(this.addPurposeDeclaration(e,Ce({},t.message,{type:void 0})),t):this.withErrorResponse(e,t,"invalid_request",{msg:"Invalid purpose declaration id"})}}]),t}(N));function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ae=O(ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/UI/login",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return console.log("login message: ",t),Te({},e,{mem:Te({},e.mem,{ui:Te({},e.mem.ui,{user:t.message.user})})})}}]),t}(N)),xe=O(ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/UI/giveConsent",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"addConsent",value:function(e,t){return C(e,{consents:e.mem.db.consents.concat(t)})}},{key:"handle",value:function(e,t){var n=t.message;if(void 0===Oe(e.mem.db.purposeDeclarations,{clientId:n.clientId,purposeDeclarationId:n.purposeDeclarationId}))return console.error("Attempt to add consent for unknown purpose declaration: ",n),e;if(void 0!==Oe(e.mem.db.consents,{clientId:t.message.clientId,purposeDeclarationId:t.message.purposeDeclarationId,dataSubject:t.message.dataSubject,revoked:!1}))return console.error("Attempt to add duplicate consent?"),e;console.log("Adding consent: ",t.message);var a=this.addConsent(e,Te({},t.message,{type:void 0})),r=e.mem.ui.user;if(void 0===r||void 0===e.mem.ui.activePurposeDeclaration[r])return a;var c=e.mem.ui.activePurposeDeclaration[r],i=Me(a,r,void 0);return c.clientId!==t.message.clientId||c.purposeDeclarationId!==t.message.purposeDeclarationId||void 0===c.callbackURL?i:this.send(i,j(t.arena,a,[c.callbackURL],ut({purposeDeclarationId:c.purposeDeclarationId})()))}}]),t}(N)),_e=O(ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/UI/revokeConsent",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"revokeIfReferenceEquals",value:function(e,t){return e.consentReference===t.consentReference?Te({},e,{revoked:!0,validUntil:t.revokeAt}):e}},{key:"revokeConsent",value:function(e,t){var n=this;return C(e,{consents:e.mem.db.consents.map((function(e){return n.revokeIfReferenceEquals(e,t)}))})}},{key:"handle",value:function(e,t){return this.revokeConsent(e,t.message)}}]),t}(N));function Ue(e,t,n){return Te({},e,Object(f.a)({},t,n))}function Me(e,t,n){return Te({},e,{mem:Te({},e.mem,{ui:Te({},e.mem.ui,{activePurposeDeclaration:Ue(e.mem.ui.activePurposeDeclaration,t,n)})})})}var Ve=O(ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/UI/activatePurposeDeclaration",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return Me(e,void 0===t.message.user?e.mem.ui.user:t.message.user,{clientId:t.message.clientId,purposeDeclarationId:t.message.purposeDeclarationId})}}]),t}(N));function Fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var qe="CS/getConsentReference/response";function Le(e){return function(t){return!t.revoked&&t.validUntil<e?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Fe(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Fe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{revoked:!0}):t}}var Be=O(ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/getConsentReference",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){var n=t.message,a=C(e,{consents:e.mem.db.consents.map(Le(new Date(1e3*t.now).toISOString()))}),r=Oe(a.mem.db.consents,{purposeDeclarationId:n.purposeDeclarationId,dataSubject:n.subjectId,revoked:!1});return void 0===r?this.withErrorResponse(Me(a,n.subjectId,{clientId:n.clientId,purposeDeclarationId:n.purposeDeclarationId,callbackURL:n.callbackURL}),t,"consent_not_found"):this.withResponse(a,t,{type:qe,clientId:t.message.clientId,purposeDeclarationId:t.message.purposeDeclarationId,consentReference:r.consentReference})}}]),t}(N)),He="ServiceProviderIS",ze="defaultView",Ke="SP/request",Je="SP/request/response";function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var We="CS/validateConsentReference/response",Qe={type:We,asyncId:"",valid:!1},$e=O(ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/validateConsentReference",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"notValid",value:function(e,t){return this.withResponse(e,t,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Qe,{asyncId:t.message.asyncId}))}},{key:"handle",value:function(e,t){var n=e.mem.db.consents.find((function(e){return e.consentReference===t.message.consentReference}));if(void 0===n)return console.log("No such consent found: ",t.message.consentReference),this.notValid(e,t);var a=new Date(1e3*t.now).toISOString();if(n.revoked||a<n.validFrom||a>n.validUntil)return console.log("Consent ".concat(n," is not valid")),this.notValid(e,t);var r=we(t.sender),c=e.mem.db.purposeDeclarations.find((function(e){return e.clientId===n.clientId&&e.purposeDeclarationId===n.purposeDeclarationId}));if(void 0===c)return console.error("Cannot find purposeDeclaration that matches to an existing consent?"),this.notValid(e,t);var i=c.services.filter((function(e){return e.serviceProviderId===r})).map((function(e){return e.serviceDeclarationId}));if(r===n.clientId){var s={type:We,asyncId:t.message.asyncId,valid:!0,consentReference:t.message.consentReference,consentExpiration:n.validUntil,dataSubjectId:n.dataSubject,clientId:n.clientId,purposeDeclarationId:n.purposeDeclarationId,serviceDeclarationId:i};return this.withResponse(e,t,s)}if(i.length>0){var o={type:We,asyncId:t.message.asyncId,valid:!0,consentReference:t.message.consentReference,consentExpiration:n.validUntil,dataSubjectId:n.dataSubject,clientId:n.clientId,serviceDeclarationId:i};return this.withResponse(e,t,o)}return this.notValid(e,t)}}]),t}(N));function Xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ye=O(ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/reportServiceUsage",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"addUsageRecord",value:function(e,t){return C(e,{usageLog:e.mem.db.usageLog.concat(t)})}},{key:"handle",value:function(e,t){return this.withOkResponse(this.addUsageRecord(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xe(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.message,{type:void 0})),t)}}]),t}(N));function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var tt=O(He,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="ServiceProvider/UI/addData",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){if(void 0===t.message.datatype||""===t.message.datatype)return et({},e,{mem:et({},e.mem,{db:e.mem.db.filter((function(e){return e.key!==t.message.key}))})});var n=t.message,a={key:n.key,type:n.datatype,subject:n.subject,data:n.data};return et({},e,{mem:et({},e.mem,{db:e.mem.db.concat(a)})})}}]),t}(N)),nt=O(He,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="ServiceProvider/UI/declareService",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return this.send(e,j(t.arena,e,[e.mem.services[0].consentService],Se()(t.message)))}}]),t}(N));function at(e,t){return Ne(e.clientId+e.consentReference+e.requestReference+e.serviceName+e.subjectId+t.consentService)}var rt=O(He,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name=Ke,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){function n(n,a){return j(t.arena,e,n,a)}var a=t.message,r=e.mem.services.find((function(e){return e.serviceName===a.serviceName}));if(void 0===r)return this.withErrorResponse(e,t,"invalid_request");if(a.clientId!==we(t.sender))return this.withErrorResponse(e,t,"invalid_request");if(!a.consentReference){var c={result:"ACCESS_DENIED",clientId:a.clientId,subjectId:a.subjectId,serviceDeclarationIds:r.requiredServiceDeclarationIds,requestReference:a.requestReference,serviceProviderId:we(e.name),usageTime:new Date(1e3*t.now).toISOString()};return this.send(this.send(e,n([r.consentService],Ye()(c))),n([t.sender],{type:"error",error:"ACCESS_DENIED"}))}var i=et({},a,{validationRequestId:at(a,r),clientAddress:t.sender}),s=et({},e,{mem:et({},e.mem,{inflight:e.mem.inflight.concat(i)})});return this.send(s,j(t.arena,s,[r.consentService],$e()({asyncId:i.validationRequestId,partyId:e.name,consentReference:a.consentReference,requestReference:a.requestReference})))}}]),t}(N));O(He,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name=We,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){function n(n,a){return j(t.arena,e,n,a)}var a=e.mem.inflight.find((function(e){return e.validationRequestId===t.message.asyncId})),r=t.message;function c(e){return et({},e,{mem:et({},e.mem,{inflight:e.mem.inflight.filter((function(e){return void 0===a||e.requestReference!==a.requestReference}))})})}if(void 0===a)return console.error("Failed to find original inflight request, ignoring the response."),e;var i=e.mem.services.find((function(e){return e.serviceName===a.serviceName}));if(void 0===i)return console.error("Failed to find the service specified in the original inflight request, ignoring the response."),c(e);var s={result:"OK",clientId:a.clientId,subjectId:a.subjectId,serviceDeclarationIds:i.requiredServiceDeclarationIds,consentReference:a.consentReference,requestReference:a.requestReference,serviceProviderId:we(e.name),usageTime:new Date(1e3*t.now).toISOString()};return!r.valid||r.clientId!==a.clientId||r.consentReference!==a.consentReference||r.dataSubjectId!==a.subjectId||void 0===r.serviceDeclarationId||i.requiredServiceDeclarationIds.find((function(e){return!r.serviceDeclarationId.includes(e)}))?this.send(this.send(c(e),n([i.consentService],Ye()(et({},s,{result:"ACCESS_DENIED"})))),n([a.clientAddress],{type:"error",error:"ACCESS_DENIED"})):this.send(this.send(c(e),n([i.consentService],Ye()(et({},s,{result:"OK"})))),n([a.clientAddress],vt()({records:e.mem.db.filter((function(e){return e.subject===a.subjectId})).filter((function(e){return i.returnedDatatypes.includes(e.type)})),asyncId:a.requestReference})))}}]),t}(N));function ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ct(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ct(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var st=O(oe,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/login",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return it({},e,{mem:it({},e.mem,{ui:it({},e.mem.ui,{user:t.message.user,service:void 0,response:[]})})})}}]),t}(N)),ot=O(oe,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/selectService",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){var n=it({},e,{mem:it({},e.mem,{ui:it({},e.mem.ui,{service:t.message.service,response:[]})})});if(void 0!==n.mem.ui.service){var a=n.mem.db.consentRefByUser[n.mem.ui.user],r=void 0===a?void 0:a[n.mem.ui.service];if(void 0===r||null===r)return this.send(n,j(t.arena,e,[e.mem.db.consentServiceId],Be({clientId:we(e.name),subjectId:e.mem.ui.user,purposeDeclarationId:t.message.service,callbackURL:e.name})()))}return n}}]),t}(N)),lt=O(oe,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/declarePurpose",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return this.send(e,j(t.arena,e,[e.mem.db.consentServiceId],Pe()(t.message)))}}]),t}(N)),ut=O(oe,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/fetchConsentReference",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return this.send(C(it({},e,{mem:it({},e.mem,{ui:it({},e.mem.ui,{service:t.message.purposeDeclarationId})})}),{consentRefByUser:mt(e.mem.db.consentRefByUser,e.mem.ui.user,t.message.purposeDeclarationId,void 0)}),j(t.arena,e,[e.mem.db.consentServiceId],Be({clientId:we(e.name),purposeDeclarationId:t.message.purposeDeclarationId,subjectId:e.mem.ui.user,callbackURL:e.name})()))}}]),t}(N));function mt(e,t,n,a){return it({},e,Object(f.a)({},t,it({},e[t],Object(f.a)({},n,a))))}O(oe,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name=qe,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return it({},e,{mem:it({},e.mem,{db:it({},e.mem.db,{consentRefByUser:mt(e.mem.db.consentRefByUser,e.mem.ui.user,t.message.purposeDeclarationId,t.message.consentReference)})})})}}]),t}(N));var dt=O(oe,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/executeRequest",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){var n=this,a=t.message,r=e.mem.db.consentRefByUser[e.mem.ui.user],c=void 0===r?void 0:r[a.purposeId],i=e.mem.config.find((function(e){return e.purposeDeclarationId===a.purposeId}));return void 0===i?(console.error("Unknown purpose? ",a),e):i.services.filter((function(e){return(void 0===a.serviceAddress||a.serviceAddress===e.serviceAddress)&&(void 0===a.serviceName||a.serviceName===e.serviceName)})).reduce((function(e,r){var i=Ne(a.requestReference+r.serviceName+r.serviceAddress),s=(e.mem.ui.response||[]).filter((function(e){return!(e.purposeDeclarationId===a.purposeId&&e.serviceAddress===r.serviceAddress&&e.serviceName===r.serviceName)})).concat({requestReferenceId:i,purposeDeclarationId:a.purposeId,serviceAddress:r.serviceAddress,serviceName:r.serviceName,data:null}),o=it({},e,{mem:it({},e.mem,{ui:it({},e.mem.ui,{response:s})})});return n.send(o,j(t.arena,o,[r.serviceAddress],rt({clientId:we(o.name),serviceName:r.serviceName,subjectId:o.mem.ui.user,consentReference:c,requestReference:i})()))}),e)}}]),t}(N));function pt(){return Ne(""+(1e6*Math.random()|0))}var vt=O(oe,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name=Je,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return it({},e,{mem:it({},e.mem,{ui:it({},e.mem.ui,{response:(e.mem.ui.response||[]).map((function(e){return e.requestReferenceId===t.message.asyncId?it({},e,{data:t.message.records}):e}))})})})}}]),t}(N));O(oe,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="error",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){switch(t.message.error){case"consent_not_found":return C(e,{consentRefByUser:mt(e.mem.db.consentRefByUser,e.mem.ui.user,e.mem.ui.service,null)})}return console.log("Unknown error, ignoring: ",t),e}}]),t}(N));var ft=O(oe,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/UI/dumpConsentRefCache",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return void 0!==t.message.purposeDeclarationId?C(e,{consentRefByUser:mt(e.mem.db.consentRefByUser,e.mem.ui.user,t.message.purposeDeclarationId,t.message.consentReference)}):C(e,{consentRefByUser:{}})}}]),t}(N)),ht=O(oe,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/validateConsentRef",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return this.send(e,j(t.arena,e,[t.message.consentServiceId||e.mem.db.consentServiceId],$e({partyId:e.name,consentReference:t.message.consentReference})()))}}]),t}(N)),bt="login",gt="selectService",yt="waitForConsent",Et="consentNotFound",Ot="serviceV1",jt=function(e){var t=e.t,r=e.props;return a.createElement("div",{className:"app-header"},a.createElement(ge,{arena:r.arena,owner:r.process,className:"btn btn-success btn-health",text:t("logout"),message:st()}),a.createElement("div",{className:"app-user-icon"},a.createElement("img",{alt:"user icon",src:n(246)})),a.createElement("p",{className:"app-user"},t("hello").replace("USERNAME",$(r.process.mem.ui.user))))};function Nt(e){return void 0===e.ui.user?bt:void 0===e.ui.service?gt:void 0===e.db.consentRefByUser[e.ui.user]||void 0===e.db.consentRefByUser[e.ui.user][e.ui.service]?yt:null===e.db.consentRefByUser[e.ui.user][e.ui.service]?Et:Ot}var wt=function(e){function t(e){var n;switch(Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).sendMessagesFor=function(e){var t=n.props.process.mem;switch(e){case yt:return void(void 0===t.ui.user||void 0===t.ui.service||void 0!==t.db.consentRefByUser[t.ui.user]&&void 0!==t.db.consentRefByUser[t.ui.user][t.ui.service]&&null!==t.db.consentRefByUser[t.ui.user][t.ui.service]||n.props.send(n.props,ut({purposeDeclarationId:t.ui.service})));case Ot:return void n.props.send(n.props,dt({requestReference:pt(),purposeId:t.ui.service}))}},n.state={view:bt,loading:!1},n.changeView=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n.setState({loading:!0}),t&&n.sendMessagesFor(e),setTimeout((function(){n.setState({loading:!1,view:e})}),600)},n.state={loading:!1,view:Nt(e.process.mem)},n.state.view){case yt:n.sendMessagesFor(n.state.view)}return n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){var e=Nt(this.props.process.mem);e!==this.state.view&&this.setState({view:e})}},{key:"render",value:function(){var e=this,t=this.props.process.mem,r=this.props.t,c=a.createElement(ge,{arena:this.props.arena,owner:this.props.process,className:"btn btn-light border",onClick:function(){return e.changeView(gt)},message:ot(),text:r("return")});switch(this.state.loading){case!0:return a.createElement("div",{className:"d-flex align-items-center"},a.createElement("strong",null,"Loading..."),a.createElement("div",{className:"spinner-border ml-auto",role:"status","aria-hidden":"true"}));default:switch(this.state.view){case bt:return a.createElement("div",null,a.createElement("form",null,a.createElement("h4",null,r("please_login")),a.createElement("div",null,a.createElement("div",{className:"input-group"},a.createElement("input",{className:"form-control",size:10,name:"user",defaultValue:"47302200234"}),a.createElement("div",{className:"input-group-append"},a.createElement(ge,{arena:this.props.arena,owner:this.props.process,className:"btn btn-light border",onClick:function(){return e.changeView(gt)},message:st(),text:r("login")})))),a.createElement("p",{className:"mt-4 mb-0"},a.createElement("img",{alt:"illustration",src:n(247),width:"280"}))));case gt:return a.createElement("div",null,a.createElement(jt,{t:r,props:this.props}),a.createElement("h4",null,r("choose_service")),this.props.process.mem.config.map((function(t){return a.createElement(ge,{key:t.purposeDeclarationId,className:"btn btn-dark mt-2 mr-2",arena:e.props.arena,owner:e.props.process,onClick:function(){return e.changeView(yt)},message:ot({service:t.purposeDeclarationId}),text:r("service",t.purposeDeclarationId,"name")})})));case yt:return a.createElement("div",null,a.createElement(jt,{t:r,props:this.props}),a.createElement("h4",null,r("checking_consent")),a.createElement("p",{className:"text-left"},r("retry_if_timed_out")),a.createElement(ge,{className:"btn btn-dark",arena:this.props.arena,owner:this.props.process,message:ut({purposeDeclarationId:t.ui.service}),text:r("retry-fetch")}));case Et:return a.createElement("div",null,a.createElement(jt,{t:r,props:this.props}),a.createElement("h4",null,r("service",t.ui.service,"consent-header")),a.createElement("p",{className:"text-left"},a.createElement("small",{dangerouslySetInnerHTML:{__html:r("service",t.ui.service,"consent-intro")}})),a.createElement("p",null,a.createElement("button",{className:"btn btn-lg btn-success btn-health",onClick:function(n){return window.open("ui/csui/",e.props.arena+" - "+t.db.consentServiceId)}},r("ill_give_consent"))),a.createElement("p",null,c));case Ot:return a.createElement("div",null,a.createElement(jt,{t:r,props:this.props}),a.createElement("h4",null,r("consented_data")),(t.ui.response||[]).filter((function(e){return e.purposeDeclarationId===t.ui.service})).map((function(e){return a.createElement("span",{className:"card mb-2",key:e.serviceAddress+" "+e.serviceName},a.createElement("pre",{className:"text-left scroll-pre"},e.serviceAddress,"/",e.serviceName,": ",JSON.stringify(e.data,void 0," ")))})),a.createElement("p",null,a.createElement(ge,{owner:this.props.process,arena:this.props.arena,className:"btn btn-success btn-health",message:dt({requestReference:pt(),purposeId:t.ui.service}),text:r("load-consented-data")})),a.createElement("p",null,c));default:return a.createElement("div",null,"Unimplemented view: ",this.state.view)}}}}]),t}(a.PureComponent),kt=Object(s.b)(null,{send:function(e,t){return j(e.arena,e.process,[e.process.name],t())}})(wt),Dt=function(e){var t=e.process,n=e.arena,r=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return W({arena:n,process:t},a)},c=a.useState(!1),i=Object(ue.a)(c,2),s=i[0],o=i[1],l=function(){return o(!1)};return a.createElement(a.Fragment,null,a.createElement(me.a,{show:s,onHide:l,size:"lg",bsPrefix:"client-app modal"},a.createElement(me.a.Header,null,a.createElement(me.a.Title,null,r("title"))),a.createElement(me.a.Body,null,a.createElement(kt,{arena:n,process:t,t:r})),a.createElement(me.a.Footer,null,a.createElement(de.a,{variant:"outline-dark",onClick:l},r("close")))),a.createElement(de.a,{variant:"success",className:"mr-2 btn-health",onClick:function(){return o(!0)}},r("open-end-user-view")))};var It=function(e){var t=e.process,n=e.arena,a=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return W({arena:n,process:t},a)},c=r.a.useState(!1),i=Object(ue.a)(c,2),s=i[0],o=i[1],l=r.a.useState([]),u=Object(ue.a)(l,2),m=u[0],d=u[1],p=function(){return o(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(me.a,{show:s,onHide:p,size:"xl"},r.a.createElement(me.a.Header,{closeButton:!0},r.a.createElement(me.a.Title,null,a("pd-declaring"))),r.a.createElement("form",null,r.a.createElement(me.a.Body,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("small",null,a("purpose-decl-intro")))),r.a.createElement("div",{className:"row border-bottom mt-4 mb-2"},r.a.createElement("div",{className:"col"},r.a.createElement("h6",null,a("declarer")," ",X(we(t.name),"name")," (",we(t.name),")"),r.a.createElement("input",{name:"clientId",type:"hidden",value:we(t.name)}))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},function(e,t,n){return void 0===t.mem.declTemplate||0===t.mem.declTemplate.length?r.a.createElement(r.a.Fragment,null):r.a.createElement("div",{className:"form-group text-danger"},r.a.createElement("label",{htmlFor:"prefilled"},e("pd-prefill")),r.a.createElement("select",{className:"form-control",id:"prefilled",onChange:function(e){return function(e,t,n){e.preventDefault();var a=e.currentTarget.value,r=e.currentTarget.form,c=t.find((function(e){return e.purposeDeclarationId===a}));void 0!==c&&(r.name.value=c.name,r.purposeDeclarationId.value=c.purposeDeclarationId,r.description.value=c.description,void 0!==c.services&&n(c.services))}(e,t.mem.declTemplate,n)},defaultValue:""},r.a.createElement("option",{key:"none",value:""},e("pd-choose-prefill")),t.mem.declTemplate.map((function(e){return r.a.createElement("option",{key:e.purposeDeclarationId,value:e.purposeDeclarationId},e.name)}))))}(a,t,d)),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"dIdentifier"},a("pd-decl-id")),r.a.createElement("input",{name:"purposeDeclarationId",type:"text",className:"form-control",id:"dIdentifier"}),r.a.createElement("small",{id:"dIdentifierHelp",className:"form-text text-muted"},a("pd-decl-id-help")))),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"dName"},a("pd-decl-name")),r.a.createElement("input",{name:"name",type:"text",className:"form-control",id:"dName"}),r.a.createElement("small",{id:"dNameHelp",className:"form-text text-muted"},a("pd-decl-name-help"))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"dataUsage"},a("pd-purpose")),r.a.createElement("textarea",{name:"description",className:"form-control",id:"dataUsage",rows:3}),r.a.createElement("small",{id:"dataUsageHelp",className:"form-text text-muted"},a("pd-purpose-help")))),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"services"},a("pd-services")),r.a.createElement("select",{name:"services",className:"custom-select",multiple:!0,id:"services",value:m.map((function(e){return JSON.stringify(e)})),onChange:function(){}},m.map((function(e){return r.a.createElement("option",{key:JSON.stringify(e),value:JSON.stringify(e)},e.serviceProviderId," ",e.serviceDeclarationId)}))),r.a.createElement("input",{name:"_spId",placeholder:a("pd-sp-id"),size:10}),r.a.createElement("input",{name:"_sdId",placeholder:a("pd-sd-id"),size:10}),r.a.createElement("button",{className:"btn-sm",onClick:function(e){return function(e,t,n){e.preventDefault();var a=e.currentTarget.form,r=a._spId.value,c=a._sdId.value;r.match("^[!-~]+$")&&c.match("^[!-~]+$")&&(n((function(e){return e.concat({serviceProviderId:r,serviceDeclarationId:c})})),a._spId.value=a._sdId.value="")}(e,0,d)}},"+"),r.a.createElement("button",{className:"btn-sm",onClick:function(e){e.preventDefault(),d([])},title:a("clear")},"X"))))),r.a.createElement(me.a.Footer,null,r.a.createElement(de.a,{variant:"secondary",onClick:p},"Close"),r.a.createElement(ge,{arena:n,owner:t,onClick:function(){return p()},text:a("declare"),message:lt()})))),r.a.createElement(de.a,{variant:"dark",onClick:function(){return o(!0)}},a("declare")))};function Ct(e){return void 0!==e.mem.ui.user}I(oe,le,(function(e){var t=e.process,n=e.arena,a=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return W({arena:n,process:t},a)};return r.a.createElement("div",null,r.a.createElement("p",null,Ct(t)?"".concat(a("active-user")," : ").concat(t.mem.ui.user):"".concat(a("no-active-user"),".")),r.a.createElement("div",{className:"row mx-1"},r.a.createElement(Dt,{arena:n,process:t}),r.a.createElement(It,{arena:n,process:t})),Ct(t)&&t.mem.config.map((function(e){return function(e,t,n,a){var c=(n.mem.db.consentRefByUser[n.mem.ui.user]||{})[t.purposeDeclarationId],i=void 0===c?e("consent-ref-not-asked"):null===c?e("consent-ref-not-found"):c,s=r.a.forwardRef((function(e,t){var n=e.children,a=e.onClick;return r.a.createElement("button",{className:"btn-link",onClick:a,ref:t},n)})),o=r.a.forwardRef((function(e,c){var i=e.style,s=e.className;return r.a.createElement("div",{ref:c,style:i,className:s},r.a.createElement("div",{className:"row no-gutters flex-nowrap"},r.a.createElement("form",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",size:6,className:"form-control",name:"consentReference"}),r.a.createElement(ge,{className:"btn btn-sm btn-outline-secondary ml-1 dropdown-close",owner:n,arena:a,message:ft({purposeDeclarationId:t.purposeDeclarationId}),text:"Set"})))))}));return r.a.createElement("span",{className:"card small mt-2",key:t.purposeDeclarationId},r.a.createElement("div",{className:"w-100 row no-gutters p-1 align-items-center"},r.a.createElement("div",{className:"col-auto flex-fill"},e("service",t.purposeDeclarationId,"name"),r.a.createElement("br",null),e("consent-ref"),r.a.createElement(pe.a,{className:"d-inline-block"},r.a.createElement(pe.a.Toggle,{as:s,id:"consentref-update-dropdown-".concat(t.purposeDeclarationId)},i),r.a.createElement(pe.a.Menu,{as:o}))),r.a.createElement("div",{className:"col-auto"},r.a.createElement(ge,{className:"btn btn-sm btn-outline-secondary",owner:n,arena:a,message:dt({requestReference:pt(),purposeId:t.purposeDeclarationId}),text:"GO",title:"Tee p\xe4ring k\xf5igile selle eesm\xe4rgi teenustele"}),r.a.createElement(ge,{className:"btn btn-sm btn-outline-secondary ml-1",owner:n,arena:a,message:ut({purposeDeclarationId:t.purposeDeclarationId}),text:e("fcr"),title:"K\xfcsi n\xf5usolekuviide uuesti"}),c&&r.a.createElement(ge,{className:"btn btn-sm btn-outline-secondary ml-1",owner:n,arena:a,message:ht({consentReference:c}),text:"vcr",title:"Valideeri n\xf5usolekuviide n\xf5usolekuteenuses"}),c&&r.a.createElement(ge,{className:"btn btn-sm btn-outline-secondary ml-1",owner:n,arena:a,message:ft({purposeDeclarationId:t.purposeDeclarationId}),text:"rcr",title:"Unusta see n\xf5usolekuviide"}))))}(a,e,t,n)})))}));var St=function(e){var t=e.currentTarget.form,n=t.consentMaxDurationSeconds.value=(t._mdValue.value-0)*t._mdUnit.value*24*3600;t._mdValue.className="form-control"+(n<1?" is-invalid":"")};function Pt(e,t){return void 0===t.mem.declTemplate||0===t.mem.declTemplate.length?r.a.createElement(r.a.Fragment,null):r.a.createElement("div",{className:"form-group text-danger"},r.a.createElement("label",{htmlFor:"prefilled"},e("sd-prefill")),r.a.createElement("select",{className:"form-control",id:"prefilled",onChange:function(e){return function(e,t){e.preventDefault();var n=e.currentTarget.value,a=e.currentTarget.form,r=t.find((function(e){return e.serviceDeclarationId===n}));if(void 0!==r){a.name.value=r.name,a.serviceDeclarationId.value=r.serviceDeclarationId,a.technicalDescription.value=r.technicalDescription,a.description.value=r.description,a.needSignature.checked=!0===r.needSignature;var c=r.consentMaxDurationSeconds||31536e3;(c=c/86400|0)>365?(a._mdValue.value=c/365|0,a._mdUnit.value=365):c>30?(a._mdValue.value=c/30|0,a._mdUnit.value=30):(a._mdValue.value=c,a._mdUnit.value=1),St({currentTarget:a.consentMaxDurationSeconds})}}(e,t.mem.declTemplate)},defaultValue:""},r.a.createElement("option",{key:"none",value:""},e("sd-choose-prefill")),t.mem.declTemplate.map((function(e){return r.a.createElement("option",{key:e.serviceDeclarationId,value:e.serviceDeclarationId},e.name)}))))}var Rt=function(e){var t=e.process,n=e.arena,a=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return W({process:t,arena:n},a)},c=r.a.useState(!1),i=Object(ue.a)(c,2),s=i[0],o=i[1],l=function(){return o(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(me.a,{show:s,onHide:l,size:"xl"},r.a.createElement(me.a.Header,{closeButton:!0},r.a.createElement(me.a.Title,null,a("declare-service-declaration"))),r.a.createElement("form",null,r.a.createElement(me.a.Body,null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("small",null,a("service-decl-intro")))),r.a.createElement("div",{className:"row border-bottom mt-4 mb-2"},r.a.createElement("div",{className:"col"},r.a.createElement("h6",null,a("declarer")," ",X(we(t.name),"name")," (",we(t.name),")"),r.a.createElement("input",{name:"serviceProviderId",type:"hidden",value:we(t.name)}))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},Pt(a,t)),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"sdIdentifier"},a("service-declaration-id")),r.a.createElement("input",{name:"serviceDeclarationId",type:"text",className:"form-control",id:"sdIdentifier"}),r.a.createElement("small",{id:"sdIdentifierHelp",className:"form-text text-muted"},a("service-declaration-id-help")))),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"sdName"},a("service-declaration-name")),r.a.createElement("input",{name:"name",type:"text",className:"form-control",id:"sdName"}),r.a.createElement("small",{id:"sdNameHelp",className:"form-text text-muted"},a("service-declaration-name-help"))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"sdTechDescription"},a("sd-tech-description")),r.a.createElement("textarea",{name:"technicalDescription",className:"form-control",id:"sdTechDescription",rows:3}),r.a.createElement("small",{id:"sdTechDescriptionHelp",className:"form-text text-muted"},a("sd-tech-description-help")))),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"sdDescription"},a("sd-description")),r.a.createElement("textarea",{name:"description",className:"form-control",id:"sdDescription",rows:3}),r.a.createElement("small",{id:"sdDescriptionHelp",className:"form-text text-muted"},a("sd-description-help")))),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"hidden",name:"consentMaxDurationSeconds",value:31536e3}),r.a.createElement("label",{htmlFor:"maxDuration"},a("sd-max-validity")),r.a.createElement("div",{className:"form-row"},r.a.createElement("div",{className:"form-group col-md"},r.a.createElement("input",{type:"number",size:3,className:"form-control",id:"maxDuration",name:"_mdValue",onChange:St,defaultValue:1})),r.a.createElement("div",{className:"form-group col-md"},r.a.createElement("select",{name:"_mdUnit",className:"form-control input-group-append",onChange:St},r.a.createElement("option",{value:365},a("year")),r.a.createElement("option",{value:30},a("month")),r.a.createElement("option",{value:1},a("day")))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"form-check"},r.a.createElement("input",{name:"needSignature",className:"form-check-input",type:"checkbox",id:"signature",value:"true|false"}),r.a.createElement("label",{className:"form-check-label",htmlFor:"signature"},a("sd-need-signature")),r.a.createElement("small",{id:"signatureHelp",className:"form-text text-muted"},a("sd-need-signature-help"))))))),r.a.createElement(me.a.Footer,null,r.a.createElement(de.a,{variant:"secondary",onClick:l},a("close")),r.a.createElement(ge,{arena:n,owner:t,onClick:function(){return l()},text:a("declare"),message:nt()})))),r.a.createElement(de.a,{variant:"dark",onClick:function(){return o(!0)}},a("declare")))};function Tt(e,t,n,a,r){return{type:He,view:ze,name:e,title:t,mem:{db:void 0===a?[]:a,services:n,inflight:[],declTemplate:r},queue:[]}}function At(e){return $(e).split(" ")[0]}function xt(e){var t=$(e);return t.substring(t.split(" ")[0].length+1)}function _t(e,t){return{"@root":e,"@extension":t}}function Ut(e){return{templateId:_t("1.3.6.1.4.1.28284.6.1.1","1.3.6.1.4.1.28284.6.1.1.40.9"),id:_t("1.3.6.1.4.1.28284.6.2.4.14","EHR.3572157"),creationTime:{"@value":"20191129133942"},versionCode:{"@code":"V3-2007-09"},interactionId:_t("2.16.840.1.113883","RCMR_IN000030UV01"),processingCode:{"@code":"P"},processingModeCode:{"@code":"T"},acceptAckCode:{"@code":"NE"},receiver:{"@typeCode":"RCV",device:{"@classCode":"DEV","@determinerCode":"INSTANCE",id:{"@root":"1.3.6.1.4.1.28284.1.26.2.5"}}},sender:{"@typeCode":"SND",device:{"@classCode":"DEV","@determinerCode":"INSTANCE",id:_t("1.3.6.1.4.1.28284.6.2.2.18.2","TL")}},acknowledgement:{typeCode:{"@code":"AA"},targetMessage:{id:_t("1.3.6.1.4.1.28284.1.26.2.7","SonumID")}},controlActProcess:{"@moodCode":"EVN","@type":"ext:RCMR_IN000030UV01_Extension.ControlActProcess","@HL7-Domain":"QUQI_DM000000UV","@realmCode":"EE",subject:[{clinicalDocument:{"@type":"ext:RCMR_MT000001UV_Extension.ClinicalDocument",templateId:_t("1.3.6.1.4.1.28284.6.1.1","1.3.6.1.4.1.28284.6.1.1.64.8"),id:_t("1.3.6.1.4.1.3516.13.1.2.3.1.3","1866393"),code:{"@code":"64","@codeSystem":"1.3.6.1.4.1.28284.6.2.1.3.9","@codeSystemName":"Dokumendi t\xfc\xfcp","@displayName":"saatekirja vastus"},statusCode:{"@code":"completed"},effectiveTime:{"@value":"20191129130504"},confidentialityCode:{"@code":"N","@codeSystem":"2.16.840.1.113883.5.25","@codeSystemName":"Konfidentsiaalsus","@displayName":"avatud"},languageCode:{"@code":"EST"},setId:_t("1.3.6.1.4.1.29907.1.1.6.11","107233297"),versionNumber:{"@value":"1"},recordTarget:{"@typeCode":"RCT",patient:{"@classCode":"PAT",id:_t("1.3.6.1.4.1.28284.6.2.2.1",e),statusCode:{"@code":"A"},patientPerson:{name:{given:At(e),family:xt(e)}}}},author:{"@typeCode":"AUT",time:{"@value":"20191129130504"},assignedAuthor:{"@classCode":"ASSIGNED","@type":"ext:RCMR_MT000001UV_Extension.COCT_MT090000UV.AssignedEntity",id:{"@nullFlavor":"NI"},representedOrganization:{"@classCode":"ORG","@determinerCode":"INSTANCE",id:_t("1.3.6.1.4.1.28284.4","10822068"),name:"AS Ida-Tallinna Keskhaigla",addr:{"@use":"PHYS",country:"EST",county:"Harju maakond",city:"Tallinn",streetName:"Ravi",houseNumber:"18",unitID:"0298",postalCode:"10138",unitType:"EHAK"}}}},custodian:{"@typeCode":"CST",assignedCustodian:{representedOrganization:{id:_t("1.3.6.1.4.1.28284.4","10822068"),name:"AS Ida-Tallinna Keskhaigla"}}},componentOf:{encompassingEncounter:{"@classCode":"ENC","@moodCode":"EVN",id:_t("1.3.6.1.4.1.29907.1.1.6.11","107233297"),effectiveTime:{"@nullFlavor":"NI"}}},sourceOf:{"@typeCode":"XCERPT",procedure:{"@classCode":"PROC","@moodCode":"EVN",code:{"@code":"3414-0","@codeSystem":"2.16.840.1.113883.6.1","@codeSystemName":"ELM\xdc LOINC koodistik","@displayName":"Buprenorfiin uriinis"},statusCode:{"@code":"completed"},effectiveTime:{"@value":"20191129130504"},specimen:{id:_t("Barcode","IP0041250068"),specimenNatural:{code:{"@code":"U","@codeSystem":"1.3.6.1.4.1.28284.6.2.1.244.5","@codeSystemName":"ELM\xdc proovimaterjali t\xfc\xfcp","@displayName":"Uriin"}},participation1:{process:{"@moodCode":"EVN",effectiveTime:{"@value":"20191129125700"}}}},sourceOf2:[{"@typeCode":"COMP",observation:{"@classCode":"OBS","@moodCode":"EVN",id:_t("1.3.6.1.4.1.3516.13.1.2.3.1.5","30591836"),code:{"@code":"ANA","@codeSystem":"1.3.6.1.4.1.28284.6.2.2.5.1","@codeSystemName":"Observation liik","@displayName":"Anal\xfc\xfcs"},value:{"@type":"CD","@code":"N","@codeSystem":"1.3.6.1.4.1.28284.6.2.1.266.3","@codeSystemName":"Kvalitatiivse uuringu vastus","@displayName":"negatiivne"},interpretationCode:{"@code":"N",originalText:null},referenceRange:{"@typeCode":"REFV",observationRange:{value:{"@type":"ED","#text":"negatiivne"},interpretationCode:{"@code":"N"}}}}},{"@typeCode":"COMP",procedure:{"@classCode":"PROC","@moodCode":"EVN",code:{"@code":"L-4888","@codeSystem":"2.16.840.1.113883.6.1","@codeSystemName":"ELM\xdc LOINC koodistik","@displayName":"N\xf5usolek lisauuringuks"},statusCode:{"@code":"completed"},specimen:{id:_t("Barcode","IP0041250068"),specimenNatural:{code:{"@code":"U","@codeSystem":"1.3.6.1.4.1.28284.6.2.1.244.5","@codeSystemName":"ELM\xdc proovimaterjali t\xfc\xfcp","@displayName":"Uriin"}},participation1:{process:{"@moodCode":"EVN",effectiveTime:{"@value":"20191129125700"}}}},sourceOf2:{"@typeCode":"COMP",observation:{"@classCode":"OBS","@moodCode":"EVN",id:_t("1.3.6.1.4.1.3516.13.1.2.3.1.5","30591834"),code:{"@code":"ANA","@codeSystem":"1.3.6.1.4.1.28284.6.2.2.5.1","@codeSystemName":"Observation liik","@displayName":"Anal\xfc\xfcs"},value:{"@type":"ED","#text":"JAH"},interpretationCode:{"@code":"N",originalText:null}}}}}]}}}}],queryAck:{queryId:_t("1.3.6.1.4.1.28284.1.26.2.8","ParinguID"),queryResponseCode:{"@code":"OK"},resultTotalQuantity:{"@value":"283"}},queryByParameter:{"@type":"ext:RCMR_MT000003UV_Extension.QueryByParameter","@HL7-Domain":"RCMR_RM000000","@realmCode":"EE",queryId:_t("1.3.6.1.4.1.28284.1.26.2.8","ParinguID"),"patient.id":{value:_t("1.3.6.1.4.1.28284.6.2.2.1",e)},"serviceEvent.code":{value:{"@code":"procedures","@codeSystem":"1.3.6.1.4.1.28284.6.2.2.32.10"}},"procedure.effectiveTime":{value:{low:{"@value":"20190101"},high:{"@value":"20191129"}}}},queryContinuation:{startResultNumber:{"@value":"1"},continuationQuantity:{"@value":"15"},statusCode:{"@code":"deliveredResponse"}}}}}function Mt(e){return{typeId:_t("2.16.840.1.113883.1.3","POCD_HD000040"),templateId:_t("1.3.6.1.4.1.28284.6.1.1","1.3.6.1.4.1.28284.6.1.1.281.1"),id:_t("1.3.6.1.4.1.28284.6.2.4.96","db923307-d53c-4c07-bab3-144afa974d1c"),code:{"@code":"83","@codeSystem":"1.3.6.1.4.1.28284.6.2.1.3.5","@codeSystemName":"Dokumendi t\xfc\xfcp","@displayName":"Immuniseerimispass"},title:"Immuniseerimispass",effectiveTime:{"@value":"20191126134144"},confidentialityCode:{"@code":"N","@codeSystem":"2.16.840.1.113883.5.25","@codeSystemName":"Konfidentsiaalsus","@displayName":"avatud"},languageCode:{"@code":"EST"},versionNumber:{"@value":"1"},recordTarget:{"@typeCode":"RCT",realmCode:{"@code":"PAT"},patientRole:{"@classCode":"PAT",id:_t("1.3.6.1.4.1.28284.6.2.2.1",e),patient:{"@classCode":"PSN","@determinerCode":"INSTANCE",name:{given:At(e),family:xt(e)}}}},author:{"@typeCode":"AUT",time:{"@value":"20191126134144"},assignedAuthor:{"@classCode":"ASSIGNED",id:_t("1.3.6.1.4.1.28284.6.2.4.32","DL"),representedOrganization:{"@classCode":"ORG","@determinerCode":"INSTANCE",id:_t("1.3.6.1.4.1.28284.6.2.4.32","DL"),name:"Tervise ja Heaolu Infos\xfcsteemide Keskus"}}},custodian:{"@typeCode":"CST",assignedCustodian:{representedCustodianOrganization:{id:_t("1.3.6.1.4.1.28284.6.2.4.32","DL"),name:"Tervise infos\xfcsteem"}}},component:{"@typeCode":"COMP",structuredBody:{"@classCode":"DOCBODY","@moodCode":"EVN",component:{"@typeCode":"COMP",section:{"@classCode":"DOCSECT","@moodCode":"EVN",code:{"@code":"IMM","@codeSystem":"1.3.6.1.4.1.28284.6.2.2.11.6","@codeSystemName":"Sektsiooni kodeering","@displayName":"Immuniseerimine"},title:"Immuniseerimine",text:{paragraph:[{content:{Immuniseerimine:"01.08.2008","Mille vastu":"Tuberkuloos",Vaktsiin:"",Partii:"ABS&<32413",ATC:"J07AN01, BCG VACCINE SSI",Annus:"400 mg","Annuse kordsus":"",Immuniseerija:"Tatjana Katjuk, kood D06176","J\xe4rgmine immuniseerimine":"",Allikas:"","Kuup\xe4ev":"05.08.2008 11:23:45","Tervishoiut\xf6\xf6taja":"Ants Kass, kood D02488",Asutus:"90006399 SA P\xf5hja-Eesti Regionaalhaigla","Dokumendi number":"27122016_0","Dokumendi t\xfc\xfcp":"Ambulatoorne epikriis"}}]}}}}}}}I(He,ze,(function(e){var t=e.process,n=e.arena,a=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return W({process:t,arena:n},a)},c=r.a.useState(!1),i=Object(ue.a)(c,2),s=i[0],o=i[1],l=function(){return o(!1)},u=function(){var e=t.mem.services.map((function(e){return e.returnedDatatypes})).flat().concat(t.mem.db.map((function(e){return e.type})));e.sort();var n=[];return e.forEach((function(e){0!==n.length&&e===n[n.length-1]||n.push(e)})),n}();return r.a.createElement("div",null,r.a.createElement("p",{className:"small"},t.mem.db.length," ",r.a.createElement("button",{className:"btn-link",onClick:function(){return o(!0)}},a("records-in-db"))),r.a.createElement(me.a,{show:s,onHide:l,size:"lg"},r.a.createElement(me.a.Header,null,r.a.createElement(me.a.Title,null,a("database"),": ",a("title"))),r.a.createElement(me.a.Body,null,r.a.createElement("form",null,r.a.createElement("table",{className:"table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"border-top-0"},"id"),r.a.createElement("th",{className:"border-top-0"},"type"),r.a.createElement("th",{className:"border-top-0"},"subject"),r.a.createElement("th",{className:"border-top-0"},"data"),r.a.createElement("th",{className:"border-top-0"}))),r.a.createElement("tbody",null,t.mem.db.map((function(e){return r.a.createElement("tr",{key:e.key},r.a.createElement("td",null,e.key),r.a.createElement("td",null,e.type),r.a.createElement("td",null,e.subject),r.a.createElement("td",null,(a=JSON.stringify(e.data,void 0," "),c=40,a&&a.length<c?a:r.a.createElement("span",{onClick:function(e){return alert(a)}},a.substring(0,c)+".."))),r.a.createElement("td",null,r.a.createElement(ge,{arena:n,owner:t,text:"-",message:tt({key:e.key,datatype:void 0,subject:void 0,data:void 0})})));var a,c})),r.a.createElement("tr",{key:"add"},r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",type:"text",size:10,name:"key",defaultValue:1e4*Math.random()|0})),r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",type:"text",size:8,name:"datatype",defaultValue:u.length>0?u[0]:""})),r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",type:"text",size:10,name:"subject"})),r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",type:"text",size:10,name:"data"})),r.a.createElement("td",null,r.a.createElement(ge,{arena:n,owner:t,text:"+",message:tt(),onClick:function(e){var t=e.currentTarget.form;t.key.value=1e4*Math.random()|0,t.datatype.value="",t.subject.value="",t.data.value=""}}))))))),r.a.createElement(me.a.Footer,null,r.a.createElement(de.a,{variant:"secondary",onClick:l},a("close")))),r.a.createElement(Rt,{arena:n,process:t}))}));var Vt=n(16);function Ft(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ft(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ft(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Lt="STATE_UPDATE",Bt="INITIALIZED",Ht=function e(){Object(u.a)(this,e),this.type=void 0,this.name=void 0,this.impl=void 0,this.view=void 0,this.mem=void 0,this.statusUpdateChannel=void 0};var zt=function(){function e(t,n,a,r,c){Object(u.a)(this,e),this.arena=void 0,this.process=void 0,this.store=void 0,this.url=void 0,this.ui=void 0,this._cachedState=void 0,this._storeUnsubscriber=null,this._messageListener=null,this._channel=void 0,this.arena=t,this.process=n,this.store=a,this.url=new URL(r,window.location.href),this.ui=void 0===c?window.open(r,"".concat(t," - ").concat(n)):c,this._channel=Math.random()}return Object(m.a)(e,[{key:"registerListeners",value:function(){var e=this;return this._storeUnsubscriber=this.store.subscribe((function(){e.stateChanged()})),this._messageListener=function(t){e.processMessage(t)},window.addEventListener("message",this._messageListener),this}},{key:"unregisterListeners",value:function(){return this._storeUnsubscriber(),this._storeUnsubscriber=null,null!==this._messageListener&&(window.removeEventListener("message",this._messageListener),this._messageListener=null),this}},{key:"stateChanged",value:function(){var e=function(e,t,n){var a=e.theatre.arenas.byName[t].process.byName[n];return void 0===a?{type:Lt,name:n,impl:"",view:""}:{type:Lt,name:n,impl:a.type,view:a.view,mem:a.mem}}(this.store.getState(),this.arena,this.process);if(e!==this._cachedState){try{this.ui.postMessage(qt({},e,{statusUpdateChannel:this._channel}),this.url.origin)}catch(t){console.error("Error posting message, stopping",t),this.unregisterListeners()}this._cachedState=e}return this}},{key:"processMessage",value:function(e){switch(e.data.type){case Bt:return this._cachedState=void 0,void this.stateChanged();default:if(e.data.statusUpdateChannel!==this._channel)return;this.store.dispatch({type:y,arena:this.arena,sender:this.process,receivers:[this.process],message:qt({},e.data,{statusUpdateChannel:void 0})})}}}]),e}(),Kt=[];var Jt=function(){function e(t,n){var a=this;Object(u.a)(this,e),this.state=void 0,this.setter=void 0,this.caster=void 0,this.setter=t,this.caster=n,console.log("setting listener"),window.addEventListener("message",(function(e){a.receiveNewState(e)}))}return Object(m.a)(e,[{key:"setState",value:function(e){console.log("updating state:",e),this.state=e,this.setter(new this.caster(e).withUpdater(this))}},{key:"resetState",value:function(){this.postMessage(Bt,{target:window.name,url:window.location.href})}},{key:"postMessage",value:function(e,t){if(null!==window.opener){var n=void 0!==this.state?{statusUpdateChannel:this.state.statusUpdateChannel}:{},a=Object.assign({},void 0===t?{}:t,{type:e},n);console.log("posting message:",a),window.opener.postMessage(a)}else this.setState({type:Lt,view:"",mem:{error:"NO OPENER WINDOW",ui:{}}})}},{key:"receiveNewState",value:function(e){e.data.type===Lt&&this.setState(e.data)}}]),e}(),Gt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this))).updater=void 0,Object.assign(Object(Vt.a)(n),e),n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"withUpdater",value:function(e){return this.updater=e,this}},{key:"post",value:function(e){var t=e();this.updater.postMessage(t.type,t)}},{key:"arena",value:function(){return window.name.split(" - ")[0]}},{key:"tRefs",value:function(){var e={arena:this.arena(),process:{name:this.name,type:this.impl}};return[function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return W(e,n)},function(t,n){return W(e,t,n)}]}}]),t}(Ht),Wt=n(135);function Qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var $t=function(e){function t(){var e,n;Object(u.a)(this,t);for(var r=arguments.length,c=new Array(r),i=0;i<r;i++)c[i]=arguments[i];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(c)))).ref=a.createRef(),n.state={msg:void 0},n.filterFn=function(e){return!(1===e.receivers.length&&e.receivers.includes(e.sender)&&!n.props.showSelf)&&!(void 0!==n.props.owner&&e.sender!==n.props.owner.name&&!e.receivers.includes(n.props.owner.name))},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"closePopup",value:function(){this.setState({msg:void 0})}},{key:"showPopup",value:function(e){this.setState({msg:e})}},{key:"componentDidUpdate",value:function(){this.scollToBottom()}},{key:"componentDidMount",value:function(){var e=this;this.props.scroll&&setTimeout((function(){e.scollToBottom()}))}},{key:"scollToBottom",value:function(){this.ref.current&&this.ref.current.scroll(0,this.ref.current.scrollHeight)}},{key:"formatLogLine",value:function(e,t,n){var r=this;return a.createElement("li",{className:"log-item",key:t},re(this.props.arena,0,e,n,(function(e){r.showPopup(e)})))}},{key:"popup",value:function(){var e,t=this.state.msg,n=this,r=this.props.t||function(e){return e};return a.createElement(me.a,{show:void 0!==t,onHide:function(){return n.closePopup()},size:"lg"},a.createElement(me.a.Body,null,void 0===t?"No message?":a.createElement("div",null,a.createElement("div",{className:"log-details"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col"},a.createElement("h4",null,r("msg-log.sender"),":"),a.createElement("p",null,t.sender))),a.createElement("div",{className:"row"},a.createElement("div",{className:"col"},a.createElement("h4",null,r("msg-log.receivers"),":"),a.createElement("p",null,1===(e=t.receivers).length?e[0]:"(".concat(e.join(", "),")")))),a.createElement("div",{className:"row"},a.createElement("div",{className:"col"},a.createElement("h4",null,r("msg-log.type"),":"),a.createElement("p",null,t.message.type))),a.createElement("div",{className:"row"},a.createElement("div",{className:"col"},a.createElement("h4",null,r("msg-log.time"),":"),a.createElement("p",null,ee(t.now))))),a.createElement("div",{className:"row"},a.createElement("div",{className:"col"},a.createElement("pre",{className:"text-left"},JSON.stringify(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qt(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{type:void 0,statusUpdateChannel:void 0,arena:void 0,now:void 0,random:void 0}),void 0,"  ")))))),a.createElement(me.a.Footer,null,a.createElement(de.a,{variant:"secondary",onClick:function(e){return n.closePopup()}},r("close"))))}},{key:"render",value:function(){var e=this,t=this.props.rows.filter(this.filterFn).slice(-(this.props.maxRows||4));return 0===t.length?a.createElement("span",{className:"no-msg-log"},W({arena:this.props.arena,process:this.props.owner||{}},["no-log-lines"])):a.createElement(a.Fragment,null,this.popup(),a.createElement("samp",{className:"msg-log",ref:this.ref},a.createElement("ul",{className:"log-view"},t.map((function(t,n){return e.formatLogLine(t,n,e.props.owner)})))))}}]),t}(a.Component);var Xt=Object(s.b)((function(e,t){return{rows:pn(e,t.arena).log}}))($t),Yt=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={show:!1},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.t;return a.createElement(a.Fragment,null,a.createElement(me.a,{show:this.state.show,onHide:function(){return e.setState({show:!1})},size:"lg"},a.createElement(me.a.Header,null,a.createElement(me.a.Title,null,W({arena:this.props.arena,process:this.props.owner},["log"]),": ",void 0!==this.props.owner?W({arena:this.props.arena,process:this.props.owner},["title"]):a.createElement(a.Fragment,null))),a.createElement(me.a.Body,null,a.createElement("div",{className:"msg-log-popup"},a.createElement(Xt,Object.assign({},this.props,{scroll:!0})))),a.createElement(Wt.a,null,a.createElement(de.a,{variant:"secondary",onClick:function(t){return e.setState({show:!1})}},t("close")))),a.createElement(de.a,{className:this.props.className,onClick:function(t){return e.setState({show:!0})}},this.props.children))}}]),t}(a.PureComponent);function Zt(e){var t=e.process,n=e.arena;return function(e){return void 0===D[e.type]?(console.error("No renderer for ".concat(e.type)),k):void 0===D[e.type][e.view]?(console.error("No renderer for ".concat(e.type," and view ").concat(e.view)),k):D[e.type][e.view]}(t)({process:t,arena:n})}function en(e){var t=e.process,n=e.arena,r=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return W({arena:n,process:t},a)},c=a.useState(!1),i=Object(ue.a)(c,2),s=i[0],o=i[1];return a.createElement("div",{className:"col"},a.createElement("div",{className:"card process style-".concat(r("stylename")),id:"proc-".concat(t.name)},a.createElement("div",{className:"card-header"},a.createElement(me.a,{show:s,onHide:function(){return o(!1)},size:"lg"},a.createElement(me.a.Header,null,a.createElement(me.a.Title,null,r("internal-state"),": ",r("title"))),a.createElement(me.a.Body,null,a.createElement("div",{className:"msg-log-popup"},a.createElement("pre",{className:"msg-log"},JSON.stringify(t,void 0,"  ")))),a.createElement(Wt.a,null,a.createElement(de.a,{variant:"secondary",onClick:function(){return o(!1)}},r("close")))),a.createElement("span",{className:"process-name",onClick:function(){return o(!0)}},r("title")),a.createElement(Yt,{arena:n,owner:t,showSelf:!0,maxRows:100,t:r,className:"btn-log btn-light btn-sm"},r("msg-log.log-button"))),a.createElement("div",{className:"card-body"},a.createElement("span",{className:"process-state"},Zt({process:t,arena:n})))))}function tn(e){var t=e.arena,n=e.process,r=e.children,c=e.button,i=Object(s.c)();function o(){!function(e,t,n,a){Kt.push(new zt(e,t,a,n).registerListeners())}(t,n.name,w[n.type],i)}var l=!0===c?"button":"div";return void 0===w[n.type]?a.createElement(a.Fragment,null):a.createElement(l,{className:!0!==c?"process-uilink":"btn btn-primary",onClick:function(){return o()}},void 0===r?"\u2398":r)}var nn;function an(e){return{type:ye,view:Ee,name:e,title:e,mem:{ui:{activePurposeDeclaration:{}},db:{serviceDeclarations:[],purposeDeclarations:[],consents:[],usageLog:[]}},queue:[]}}function rn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rn(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}I(ye,Ee,(function(e){var t=e.process,n=e.arena,a=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return W({process:t,arena:n},a)},c=(new Date).toISOString();return r.a.createElement("div",null,r.a.createElement("p",null,void 0!==t.mem.ui.user?"".concat(a("active-user")," : ").concat(t.mem.ui.user):"".concat(a("no-active-user"),".")),r.a.createElement("p",{className:"small"},t.mem.db.serviceDeclarations.length," ",a("service-declarations"),", ",r.a.createElement("br",null),t.mem.db.purposeDeclarations.length," ",a("purpose-declarations"),", ",r.a.createElement("br",null),t.mem.db.consents.filter((function(e){return!e.revoked&&e.validFrom<=c&&e.validUntil>=c})).length," ",a("active-consents"),", ",r.a.createElement("br",null),t.mem.db.consents.length," ",a("total-consents")),r.a.createElement(tn,{process:t,arena:n,button:!0}," ",a("open-end-user-view")))})),nn="./ui/csui/",w[ye]=nn;var sn="EE/GOV/70009770/nt";function on(e,t,n){return{key:""+(1e4*Math.random()|0),type:t,subject:e,data:n}}var ln={defaultArena:"demo",arenas:{demo:function(){return{processes:[(t="EE/COM/10112345/healthstartup",n=sn,a=[{purposeDeclarationId:"tervisepaevik_vaktsineerimised",services:[{serviceAddress:"EE/GOV/70009770/digilugu",serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.282"}]},{purposeDeclarationId:"tervisepaevik_visualiseerimine",services:[{serviceAddress:"EE/GOV/70009770/digilugu",serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.32"},{serviceAddress:"EE/GOV/70009770/digilugu",serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.35"}]}],r=[{purposeDeclarationId:"tervisepaevik_visualiseerimine",name:"Terviseandmete visualiseerimine",description:"HealthStartup diagnooside ja uuringute tulemuste visualiseerimist pakkuv teenus.\n\nN\xf5usoleku tagasiv\xf5tmisel kustutab HealthStartup k\xf5ik Sinu kohta saadud andmed.",services:[{serviceProviderId:"EE/GOV/70009770",serviceDeclarationId:"hl7_diagnoosid"},{serviceProviderId:"EE/GOV/70009770",serviceDeclarationId:"hl7_uuringud"}]},{purposeDeclarationId:"tervisepaevik_vaktsineerimised",name:"Vaktsineerimiste meeldetuletused",description:"HealthStartup vaktsineerimiste meeldetuletusi ja immuniseerimisplaani pakkuv teenus.\n\nN\xf5usoleku tagasiv\xf5tmisel kustutab HealthStartup k\xf5ik Sinu kohta saadud andmed.",services:[{serviceProviderId:"EE/GOV/70009770",serviceDeclarationId:"hl7_immuniseerimispass"}]}],{type:oe,view:le,name:t,title:t,mem:{ui:{},db:{consentServiceId:n,consentRefByUser:{},purpose:{}},declTemplate:r,config:a},queue:[]}),Tt("EE/GOV/70009770/digilugu","Tervise Infos\xfcsteem",[{serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.282",consentService:sn,requiredServiceDeclarationIds:["hl7_immuniseerimispass"],returnedDatatypes:["immuniseerimine"]},{serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.35",consentService:sn,requiredServiceDeclarationIds:["hl7_uuringud"],returnedDatatypes:["uuring"]},{serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.32",consentService:sn,requiredServiceDeclarationIds:["hl7_diagnoosid"],returnedDatatypes:["diagnoos"]}],[on("01234567890","diagnoos",{diagnoos:"A01",arst:"D03677"}),on("12345678901","diagnoos",{diagnoos:"J01",arst:"D08031"}),on("47302200234","diagnoos",(e="47302200234",{templateId:_t("1.3.6.1.4.1.28284.6.1.1","1.3.6.1.4.1.28284.6.1.1.37.3"),id:_t("1.3.6.1.4.1.28284.6.2.4.14","EHR.3570338"),creationTime:{"@value":"20191127131137"},versionCode:{"@code":"V3-2007-09"},interactionId:_t("2.16.840.1.113883","RCMR_IN000030UV01"),processingCode:{"@code":"P"},processingModeCode:{"@code":"T"},acceptAckCode:{"@code":"NE"},receiver:{"@typeCode":"RCV",device:{"@classCode":"DEV","@determinerCode":"INSTANCE",id:_t("1.3.6.1.4.1.28284.8.7.2.5","Tallinn")}},sender:{"@typeCode":"SND",device:{"@classCode":"DEV","@determinerCode":"INSTANCE",id:_t("1.3.6.1.4.1.28284.6.2.2.18.2","TL")}},acknowledgement:{typeCode:{"@code":"AA"},targetMessage:{id:_t("1.3.6.1.4.1.28284.8.7","1.3.6.1.4.1.28284.8.7_637104570979090003")}},controlActProcess:{"@moodCode":"EVN","@type":"ext:RCMR_IN000030UV01_Extension.ControlActProcess","@HL7-Domain":"QUQI_DM000000UV","@realmCode":"EE",subject:{clinicalDocument:{"@type":"ext:RCMR_MT000001UV_Extension.ClinicalDocument",templateId:_t("1.3.6.1.4.1.28284.6.1.1","1.3.6.1.4.1.28284.6.1.1.5.8"),id:_t("1.3.6.1.4.1.28284.8.7.2.2.3","11356823.S140.1"),code:{"@code":"2","@codeSystem":"1.3.6.1.4.1.28284.6.2.1.3.1","@codeSystemName":"Dokumendi t\xfc\xfcp","@displayName":"Ambulatoorne epikriis"},statusCode:{"@code":"completed"},effectiveTime:{"@value":"20191127131059"},confidentialityCode:{"@code":"N","@codeSystem":"2.16.840.1.113883.5.25","@codeSystemName":"Konfidentsiaalsus","@displayName":"avatud",translation:[{"@code":"N","@codeSystem":"1.3.6.1.4.1.28284.6.2.2.39.1","@codeSystemName":"Konfidentsiaalsus arstile","@displayName":"avatud"},{"@code":"N","@codeSystem":"1.3.6.1.4.1.28284.6.2.2.37.1","@codeSystemName":"Konfidentsiaalsus eestkostjale","@displayName":"avatud"}]},languageCode:{"@code":"EST"},setId:_t("1.3.6.1.4.1.28284.8.7.2.1","140.1"),versionNumber:{"@value":"1"},recordTarget:{"@typeCode":"RCT",realmCode:{"@code":"PAT"},patient:{"@classCode":"PAT",id:_t("1.3.6.1.4.1.28284.6.2.2.16.1",e),statusCode:{"@code":"A"},patientPerson:{"@classCode":"PSN",name:{given:At(e),family:xt(e)}}}},author:{"@typeCode":"AUT",time:{"@value":"20191127131059"},assignedAuthor:{"@classCode":"ASSIGNED","@type":"ext:RCMR_MT000001UV_Extension.COCT_MT090000UV.AssignedEntity",id:_t("1.3.6.1.4.1.28284.6.2.4.9","D04220"),code:{"@code":"DOCTOR","@codeSystem":"1.3.6.1.4.1.28284.6.2.2.15.1","@codeSystemName":"Tervishoiut\xf6\xf6taja t\xfc\xfcp","@displayName":"arst"},assignedPerson:{"@classCode":"PSN","@determinerCode":"INSTANCE",name:{given:At(e),family:xt(e)}},asLicencedEntity:{id:{"@root":"1.3.6.1.4.1.28284.6.2.1.4.2","@extension":"E420","@assigningAuthorityName":"\xfcldkirurgia"}}}},componentOf:{encompassingEncounter:{"@classCode":"ENC","@moodCode":"EVN",id:_t("1.3.6.1.4.1.28284.8.7.2.1","140.1"),code:{"@code":"AMB","@codeSystem":"1.3.6.1.4.1.28284.6.2.1.5.1","@codeSystemName":"Haigusjuhtumi t\xfc\xfcp","@displayName":"Ambulatoorne haigusjuht"},effectiveTime:{low:{"@value":"20191127131033"},high:{"@value":"20191127131033"}}}},sourceOf:{"@typeCode":"XCERPT",observation:{"@classCode":"OBS","@moodCode":"EVN",code:{"@code":"DGN","@codeSystem":"1.3.6.1.4.1.28284.6.2.2.5.1","@codeSystemName":"Observation liik","@displayName":"Diagnoos"},statusCode:{"@code":"completed"},value:{"@code":"F02.2","@codeSystem":"1.3.6.1.4.1.28284.6.2.1.13.3","@codeSystemName":"RHK-10","@displayName":"Dementsus Huntingtoni t\xf5vest","@type":"CD",originalText:null,qualifier:{value:{"@code":"1","@codeSystem":"1.3.6.1.4.1.28284.6.2.1.1.2","@codeSystemName":"Diagnoosi statistiline liik","@displayName":"esmajuhtum"}}},interpretationCode:{"@code":"MAIN","@codeSystem":"1.3.6.1.4.1.28284.6.2.1.2.1","@codeSystemName":"Diagnoosi liik","@displayName":"P\xf5hihaigus"}}}}},queryAck:{queryId:_t("1.3.6.1.4.1.28284.8.7.2.7","1.3.6.1.4.1.28284.8.7_637104570979090003"),queryResponseCode:{"@code":"OK"},resultTotalQuantity:{"@value":"1"}},queryByParameter:{"@type":"ext:RCMR_MT000003UV_Extension.QueryByParameter","@HL7-Domain":"RCMR_RM000000","@realmCode":"EE",queryId:_t("1.3.6.1.4.1.28284.8.7.2.7","1.3.6.1.4.1.28284.8.7_637104570979090003"),"patient.id":{value:_t("1.3.6.1.4.1.28284.6.2.2.16.1",e)},"serviceEvent.code":{value:{"@code":"diagnosis","@codeSystem":"1.3.6.1.4.1.28284.6.2.2.32.2"}},"observation.effectiveTime":{value:{low:{"@value":"20161127000000"},high:{"@value":"20191128235959"}}}}}})),on("47302200234","uuring",Ut("47302200234")),on("47302200234","immuniseerimine",Mt("47302200234"))],[{serviceDeclarationId:"hl7_uuringud",name:"Uuringute p\xe4ring",technicalDescription:"X-tee teenuse 'hl7' p\xe4ring, HL7 OID: 1.3.6.1.4.1.28284.6.1.1.35",description:"Andmekogule saadetakse p\xe4ringu parameetrina Sinu isikukood.\n\nAndmekogust Tervise Infos\xfcsteem saadakse iga Sinu uuringu kohta j\xe4rgmised andmed:\n  * Sinu andmed: nimi ja isikukood:\n  * Uuringu andmed:\n    * Uuringu tegemise aeg ja koht (raviasutus)\n    * Proovimaterjali t\xfc\xfcp\n    * Uuringu t\xfc\xfcp\n    * Uuringu vastus\n  * Uuringu teostanud tervishoiut\xf6\xf6taja andmed: nimi, kood ja tervishoiuasutuse andmed",needSignature:!0,consentMaxDurationSeconds:15768e4},{serviceDeclarationId:"hl7_diagnoosid",name:"Diagnooside p\xe4ring",technicalDescription:"X-tee teenuse 'hl7' p\xe4ring, HL7 OID: 1.3.6.1.4.1.28284.6.1.1.32",description:"Andmekogust Tervise Infos\xfcsteem saadakse iga Sinu diagnoosi kohta j\xe4rgmised andmed:\n  * Sinu andmed: nimi ja isikukood\n  * Haigusjuhtumi andmed: diagnoosi andmise aeg, diagnoos\n  * Diagnoosi andnud tervishoiut\xf6\xf6taja andmed: nimi, kood ja tervishoiuasutuse andmed",needSignature:!0,consentMaxDurationSeconds:15768e4},{serviceDeclarationId:"hl7_immuniseerimispass",name:"Immuniseerimispassi p\xe4ring",technicalDescription:"X-tee teenuse 'hl7' p\xe4ring, HL7 OID: 1.3.6.1.4.1.28284.6.1.1.282",description:"Andmekogust Tervise Infos\xfcsteem saadakse iga Sinu immuniseerimise kohta j\xe4rgmised andmed:\n  * Sinu andmed: nimi ja isikukood\n  * Immuniseerimise andmed:\n    * Haigus mille vastu immuniseeriti\n    * Immuniseerimise kuup\xe4ev\n    * Immuunpreparaadi nimi, partii number ja manustatud annus\n    * Mitmes annus\n    * J\xe4rgmine immuniseerimise varaseim kuup\xe4ev\n  * Immuniseerija andmed: nimi, kood ja tervishoiuasutuse andmed",needSignature:!0,consentMaxDurationSeconds:15768e4}]),an("EE/GOV/70009770/nt")],logRenderers:cn({},se)};var e,t,n,a,r}()}};function un(){return{name:"theatre",arenas:A(Object.keys(ln.arenas).map((function(e){return t=e,n=ln.arenas[e].processes,{name:t,process:A(n),log:[]};var t,n}))),active:ln.defaultArena}}function mn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function dn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mn(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pn(e,t){return e.theatre.arenas.byName[t]}Object.keys(ln.arenas).forEach((function(e){void 0!==ln.arenas[e].logRenderers&&ie(e,ln.arenas[e].logRenderers)}));var vn="Theatre/SELECT_ARENA";var fn=Object(s.b)((function(e,t){return{log:pn(e,t.arena.name).log}}))((function(e){var t=e.arena,n=Object(G.c)().t,r=t.process.allNames.map((function(e){return a.createElement(en,{process:t.process.byName[e],arena:t.name,key:e})}));return a.createElement("div",null,a.createElement("div",{className:"row align-self-stretch"},r),a.createElement("div",{className:"card w-100 mt-4 mb-2"},a.createElement("div",{className:"card-body"},a.createElement("h5",{className:"card-title"},n("msg-log.title")),0===t.log.length&&a.createElement("div",{className:"d-flex align-items-center"},a.createElement("div",{className:"spinner-grow spinner-grow-sm",role:"status"}),a.createElement("p",{className:"card-text ml-1"},n("msg-log.empty"))),a.createElement(Xt,{arena:t.name,showSelf:!1,maxRows:1e3}))))})),hn=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){n(90),n(249)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(fn,{arena:this.props.theatre.arenas.byName[this.props.theatre.active]}))}}]),t}(r.a.PureComponent),bn=Object(s.b)((function(e){return{theatre:e.theatre}}))(hn);var gn=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return this.props.arenaNames.length<2?null:r.a.createElement(G.a,null,(function(t){return r.a.createElement("select",{className:"form-component",onChange:function(t){return e.props.selectArenaMessage(t.currentTarget.value)}},e.props.arenaNames.map((function(e){return r.a.createElement("option",{value:e,key:e},t(e+".arenaname"))})))}))}}]),t}(r.a.PureComponent),yn=Object(s.b)(void 0,{selectArenaMessage:function(e){return{type:vn,arena:e}}})(gn);function En(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function On(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?En(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):En(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var jn=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(m.a)(t,[{key:"login",value:function(e,t){console.log("login(",t,")"),e.preventDefault(),this.post(Ae({user:t}))}},{key:"giveConsentByPurpose",value:function(e,t,n,a){console.log("giveConsent(".concat(n,", ").concat(a,")")),e.preventDefault(),this.post(xe({dataSubject:this.mem.ui.user,clientId:n,purposeDeclarationId:a,validFrom:(new Date).toISOString(),validUntil:this.getValidUntil(t),revoked:!1,consentReference:Ne(n+a+Date.now())}))}},{key:"revokeConsent",value:function(e,t){console.log("revokeConsent(".concat(t,")")),e.preventDefault(),this.post(_e({consentReference:t,revokeAt:(new Date).toISOString()}))}},{key:"getConsents",value:function(e){if(void 0===this.mem)return[];var t=(new Date).toISOString(),n=this.mem.ui.user;return this.mem.db.consents.map(Le(t)).filter((function(a){return a.dataSubject===n&&(void 0===e||e===(a.validFrom<=t&&a.validUntil>=t&&!a.revoked))}))}},{key:"getPDsWithoutValidConsent",value:function(){if(void 0===this.mem)return console.error("Not connected? No local state yet"),[];var e=this.getConsents(!0);return this.mem.db.purposeDeclarations.filter((function(t){return void 0===e.find((function(e){return e.clientId===t.clientId&&e.purposeDeclarationId===t.purposeDeclarationId}))}))}},{key:"getUsageLogRecords",value:function(){var e=this;return void 0===this.mem?[]:this.mem.db.usageLog.filter((function(t){return t.subjectId===e.mem.ui.user}))}},{key:"activatePurposeDeclaration",value:function(e,t){e.preventDefault(),void 0!==this.mem&&this.post(Ve(t))}},{key:"getActivePurposeDeclaration",value:function(){if(void 0!==this.mem&&void 0!==this.mem.ui.activePurposeDeclaration&&void 0!==this.mem.ui.activePurposeDeclaration[this.mem.ui.user]){var e=Oe(this.mem.db.purposeDeclarations,On({},this.mem.ui.activePurposeDeclaration[this.mem.ui.user],{callbackURL:void 0}));if(void 0!==e&&void 0===Oe(this.getConsents(!0),{clientId:e.clientId,purposeDeclarationId:e.purposeDeclarationId}))return On({},e,{validUntil:this.getValidUntil(this.mem.db.serviceDeclarations)})}}},{key:"getServiceDeclaration",value:function(e){if(void 0!==this.mem)return Oe(this.mem.db.serviceDeclarations,e)}},{key:"getPurposeDeclaration",value:function(e){if(void 0!==this.mem)return Oe(this.mem.db.purposeDeclarations,e)}},{key:"getValidUntil",value:function(e){var t=this,n=e.map((function(e){return t.getServiceDeclaration(e).consentMaxDurationSeconds})).sort()[0];return new Date(Date.now()+1e3*n).toISOString()}}]),t}(Gt),Nn=r.a.createContext(void 0),wn=function(){function e(){Object(u.a)(this,e)}return Object(m.a)(e,[{key:"use",value:function(){var e=Object(a.useContext)(Nn);return void 0===e||null===e?e:new jn(e)}}]),e}(),kn=function(){return a.createElement("footer",null,a.createElement("div",{className:"footer-top"},a.createElement("div",{className:"footer-contact"},a.createElement("div",null,a.createElement("div",{className:"footer-contact-icon"},a.createElement("i",{className:"icon-phone"}))),a.createElement("div",{className:"footer-contact-text"},a.createElement("table",null,a.createElement("tbody",null,a.createElement("tr",null,a.createElement("th",null,a.createElement("a",{className:"link-phone",href:"tel:+372-555-1"},"555 1234")),a.createElement("th",null,"\xdcldinfo")),a.createElement("tr",null,a.createElement("td",null,a.createElement("a",{className:"link-phone",href:"tel:+372-555-1234"},"555 1234")),a.createElement("td",null,"Teine osakond")),a.createElement("tr",null,a.createElement("td",null,a.createElement("a",{className:"link-phone",href:"tel:+372-555-1234"},"555 1234")),a.createElement("td",null,"Kolmas osakond")))),a.createElement("a",{className:"link-orange",href:"http://www.digilugu.ee/",target:"_blank",rel:"noopener noreferrer"},"K\xf5ik kontaktandmed")))))},Dn=function(){var e=Object(G.c)().i18n;return r.a.createElement("div",{className:"language"},e.options.whitelist&&e.options.whitelist.filter((function(e){return"cimode"!==e})).map((function(t){return r.a.createElement("a",{href:"#!",key:t,onClick:function(n){var a;n.preventDefault(),a=t,e.changeLanguage(a)},className:e.language===t||e.language.startsWith(t+"-")?"active":""},t)})))},In=function(e){var t=e.backend.use(),r=t?t.tRefs():[],c=Object(ue.a)(r,1)[0];return a.createElement(G.a,null,(function(e){return a.createElement(a.Fragment,null,a.createElement("nav",{className:"navbar"},a.createElement("ul",{className:"navbar-nav desktop-nav"},a.createElement("li",{className:"nav-item with-logo"},a.createElement("img",{className:"logo-brand",alt:"logo",width:"170",src:n(250)})),a.createElement("li",{className:"nav-item"},a.createElement(Dn,null)),t&&t.mem&&t.mem.ui.user&&a.createElement("li",{className:"nav-item with-title"},a.createElement("p",{className:"nav-item-title"},c("header-user")),a.createElement("p",null,$(t.mem.ui.user))),t&&t.mem&&t.mem.ui.user&&a.createElement("li",{className:"nav-item nav-logout"},a.createElement("button",{className:"btn btn-logout",onClick:function(e){return t.login(e)}},c("header-logout"))))))}))},Cn=function(e){var t=e.children,n=e.backend,a=n.use();return r.a.createElement("div",{className:"wrapper "+(a&&a.mem&&a.mem.ui.user?"push":"")},a&&a.mem&&a.mem.ui.user&&r.a.createElement(In,{backend:n}),r.a.createElement("div",{className:"content-wrapper"},r.a.createElement("div",{className:"workarea"},t)),r.a.createElement(kn,null))},Sn=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(){var e=n.props,t=e.label;(0,e.onClick)(t)},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.onClick,t=this.props,n=t.activeTab,a=t.label,c=t.id,i="sidebar-item";return n===c&&(i+=" active"),r.a.createElement("li",{className:i,onClick:e,style:{cursor:"pointer"},key:c},a)}}]),t}(r.a.Component),Pn=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).onClickTabItem=function(e){n.setState({activeTab:e})},n.state={activeTab:n.props.children[0].props.id},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.onClickTabItem,t=this.props.children,n=this.state.activeTab;return r.a.createElement("div",null,r.a.createElement("div",{id:"sidebar"},r.a.createElement("ol",null,t.filter((function(e){return void 0!==e.props.label})).map((function(t){var a=t.props,c=a.id,i=a.label;return r.a.createElement(Sn,{activeTab:n,key:c,label:i,id:c,onClick:function(){return e(c)}})})))),r.a.createElement("div",{className:"section"},t.map((function(e){if(e.props.id===n)return e.props.children}))))}}]),t}(r.a.Component),Rn=function(e){var t=e.backend,n=e.consent,a=e.buttonText,c=t.tRefs(),i=Object(ue.a)(c,2),s=i[0],o=i[1],l=r.a.useState(!1),u=Object(ue.a)(l,2),m=u[0],d=u[1],p=function(){return d(!1)};if(void 0===t.mem)return null;var v=t.mem.db.purposeDeclarations.find((function(e){return e.purposeDeclarationId===n.purposeDeclarationId}));if(void 0===v)return null;var f=function(e,t,n){return r.a.createElement("div",{className:"row",key:e},r.a.createElement("div",{className:"col-md"},r.a.createElement("div",{className:n?"d-flex align-items-end":"d-flex align-items-baseline"},r.a.createElement("div",null,r.a.createElement("h4",null," ",e)),r.a.createElement("div",null,t))))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(me.a,{show:m,onHide:p,size:"lg"},r.a.createElement(me.a.Header,null,r.a.createElement(me.a.Title,null,s("consent-details"))),r.a.createElement(me.a.Body,null,r.a.createElement((function(){var e=v.services.map((function(e){var n=t.getServiceDeclaration(e);return void 0===n?r.a.createElement(r.a.Fragment,null):r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,n.name),De(n.description))}));return r.a.createElement("div",{className:"tab-info"},f(s("consent-client"),"".concat(X(v.clientId,"name")," (").concat(X(v.clientId,"ntr"),")")),f(s("consent-purpose-name"),"".concat(v.name)),f(s("consent-given-at"),Bn(ke(n.validFrom))),Tn(n)?f(s("consent-valid-until"),Bn(ke(n.validUntil))):f(s("consent-withdrawn-at"),Bn(ke(n.validUntil))),f(s("consent-purpose-text"),De(v.description),!0),f(o(["gets-under-consent"],{clientName:X(v.clientId,"name")}),e,!0))}),null)),r.a.createElement(me.a.Footer,null,Tn(n)&&r.a.createElement(de.a,{variant:"primary",onClick:function(e){return function(e){d(!1),t.revokeConsent(e,n.consentReference)}(e)}},s("consent-withdraw-consent")),r.a.createElement(de.a,{variant:"secondary",onClick:p},s("close")))),r.a.createElement(de.a,{variant:"primary",onClick:function(){return d(!0)}},a))};function Tn(e){return!e.revoked&&e.validUntil>(new Date).toISOString()}var An=function(e){var t=e.tRefs(),n=Object(ue.a)(t,2),a=n[0],c=n[1],i=function(t,n){return r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,n),r.a.createElement("table",{className:"table align-middle"},r.a.createElement("tbody",null,t.map((function(t){return r.a.createElement("tr",{key:t.clientId},r.a.createElement("td",null,function(e,t,n,a){var r=n.getPurposeDeclaration({clientId:a.clientId,purposeDeclarationId:a.purposeDeclarationId});return t(["consent-description-line"],{clientName:X(a.clientId,"name"),purposeDeclName:r.name,endName:e(a.revoked?"consent-desc-withdrawn-at":"consent-desc-valid-until"),validFrom:Bn(ke(a.validFrom)),validUntil:Bn(ke(a.validUntil))})}(a,c,e,t)),r.a.createElement("td",null,r.a.createElement(Rn,{backend:e,consent:t,buttonText:a("consent-open-details")})))})))))};return r.a.createElement("div",{label:a("tab-my-consents"),id:"tab-my-consents",key:"tab-my-consents"}," ",function(e){if(0===e.getConsents().length)return r.a.createElement("p",null,a("no-consents-found"));var t=function(e,t){return r.a.createElement("h4",null,r.a.createElement("span",null,e),0===t&&r.a.createElement("span",{className:"badge badge-default ml-2"},r.a.createElement("span",{className:"badge-text"},a("consents-missing-badge"))))};return r.a.createElement(r.a.Fragment,null,i(e.getConsents(!0),t(a("valid-consents"),e.getConsents(!0).length)),i(e.getConsents(!1),t(a("invalid-consents"),e.getConsents(!1).length)))}(e)," ")};function xn(e,t,n,a){return Ln(ke(t.usageTime),!0)+" "+X(t.clientId,"name")+(a?e(["purpose-in-usage-log"],{purposeName:a.name}):"")}var _n=function(e){var t=e.tRefs(),n=Object(ue.a)(t,2),a=n[0],c=n[1];return r.a.createElement("div",{label:a("tab-consent-usage-log"),id:"tab-usagelog",key:"tab-usagelog"},function(e){return 0===e.getUsageLogRecords().length?r.a.createElement("p",null,a("no-consent-use-events")):r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,a("use-history")),r.a.createElement("table",{className:"table align-middle"},r.a.createElement("tbody",null,e.getUsageLogRecords().map((function(t){return r.a.createElement("tr",{key:t.clientId},r.a.createElement("td",null,function(e,t,n){var a=n.getConsents().find((function(e){return e.consentReference===t.consentReference}));if(!a)return xn(e,t)+e(["reason-no-consent"],{});var r=n.getPurposeDeclaration({clientId:t.clientId,purposeDeclarationId:a.purposeDeclarationId});return"OK"===t.result?xn(e,t,0,r)+e(["reason-ok"],{}):xn(e,t,0,r)+e(["reason-consent-not-valid"],{})}(c,t,e)),t.consentReference?function(e,t){if(e.mem){var n=e.mem.db.consents.find((function(e){return e.consentReference===t}));if(n)return r.a.createElement("td",null,r.a.createElement(Rn,{backend:e,consent:n,buttonText:a("usage-open-consent")}))}}(e,t.consentReference):r.a.createElement(r.a.Fragment,null))})))))}(e))};function Un(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Un(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Un(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vn=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={signPopup:!1,returnPopup:!1},n.showConsentTab=n.showConsentTab.bind(Object(Vt.a)(n)),n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"showSignPopup",value:function(e){this.setState((function(t){return Mn({},t,{signPopup:e})}))}},{key:"showReturnPopup",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;this.setState((function(n){return Mn({},n,{returnPopup:e,savedClientId:t})}))}},{key:"toggleSignPopup",value:function(){this.setState((function(e){return Mn({},e,{signPopup:!e.signPopup})}))}},{key:"showConsentTab",value:function(e){e.preventDefault(),this.props.tabRef.current&&this.props.tabRef.current.onClickTabItem("tab-my-consents")}},{key:"Popover",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(me.a,{show:this.state.signPopup,onHide:function(){return e.toggleSignPopup()}},r.a.createElement(me.a.Body,null,r.a.createElement("h4",null,this.props.t("consent-request-sign-digitally"))),r.a.createElement(me.a.Footer,null,r.a.createElement("button",{className:"btn btn-primary",onClick:function(t){e.props.backend.giveConsentByPurpose(t,e.props.activeDecl.services,e.props.activeDecl.clientId,e.props.activeDecl.purposeDeclarationId),e.toggleSignPopup(),e.showReturnPopup(!0,e.props.activeDecl.clientId)}},this.props.t("consent-request-sign")),r.a.createElement(de.a,{variant:"secondary",onClick:function(t){return e.toggleSignPopup()}},this.props.t("consent-request-back")))),r.a.createElement(de.a,{variant:"primary",className:"mr-2",onClick:function(t){return e.toggleSignPopup()}},this.props.t("consent-request-give")),r.a.createElement(de.a,{variant:"secondary",onClick:function(e){return window.close()}},this.props.t("consent-request-do-not-give")))}},{key:"ReturnScreen",value:function(){var e=this,t=this.props.t;return r.a.createElement("div",null,r.a.createElement("h4",null,t("consent-to"),X(this.state.savedClientId,"name"),t("consent-to-after")),r.a.createElement("p",null,t("consent-given-all-consents"),r.a.createElement("a",{href:"../../ui/csui",onClick:this.showConsentTab},t("tab-my-consents")),t("consent-given-all-consents-after")),r.a.createElement("button",{className:"btn btn-primary",onClick:function(){window.close(),e.showReturnPopup(!1)}},t("consent-given-return")))}},{key:"render",value:function(){var e=this,t=this.props.activeDecl;return void 0===t?this.state.returnPopup?this.ReturnScreen():r.a.createElement("div",null,this.props.t("no-open-consent-request")):r.a.createElement("div",{className:"tab-info"},r.a.createElement("h4",{className:"mb-4 title"},this.props.t_(["asks-for-consent"],{clientName:X(t.clientId,"name"),clientNTR:X(t.clientId,"ntr")})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"},r.a.createElement("div",{className:"d-flex align-items-baseline"},r.a.createElement("div",null,r.a.createElement("h4",null,this.props.t("purpose-of-use"))),r.a.createElement("div",null,De(t.description))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"},r.a.createElement("div",{className:"d-flex align-items-end"},r.a.createElement("div",null,r.a.createElement("h4",null,this.props.t("validity"))),r.a.createElement("div",null,t.validUntil&&"".concat(this.props.t("valid-until")).concat(Ln(ke(t.validUntil))))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"},r.a.createElement("div",{className:"d-flex align-items-end"},r.a.createElement("div",null,r.a.createElement("h4",null,this.props.t_(["gets-under-consent"],{clientName:X(t.clientId,"name"),clientNTR:X(t.clientId,"ntr")}))),r.a.createElement("div",null,t.services.map((function(t){var n=e.props.backend.getServiceDeclaration(t);return void 0===n?r.a.createElement(r.a.Fragment,null):r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,n.name),De(n.description))})))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md mt-4 mb-2 text-muted"},this.props.t("you-can-withdraw"),r.a.createElement("a",{href:"../../ui/csui",onClick:this.showConsentTab},this.props.t("tab-my-consents")))),r.a.createElement("p",{className:"mt-4"},this.Popover()))}}]),t}(r.a.PureComponent),Fn=function(e){Object(G.c)();var t=e.backend.use();if(null===t||void 0===t)return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"section"},"Wait, or reinit the client UI from the main window... '",window.name,"'"));var n=t.tRefs(),a=Object(ue.a)(n,2),c=a[0],i=a[1];if(void 0===t.mem.ui.user)return function(e){return r.a.createElement("div",{className:"section"},r.a.createElement("h4",null,e("please-login")),r.a.createElement("p",{className:"mt-3"},r.a.createElement("a",{href:"../ria/",className:"btn btn-primary"},e("login"))))}(c);var s=t.getActivePurposeDeclaration();return r.a.createElement(Pn,{ref:e.tabRef},r.a.createElement("div",{label:c("tab-open-consent-requests"),id:"tab-open-requests",key:"tab-open-requests"},r.a.createElement(Vn,{label:c("tab-open-consent-requests"),id:"tab-open-requests",backend:t,activeDecl:s,tabRef:e.tabRef,t:c,t_:i})),An(t),_n(t))},qn=function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e,n))).backendLink=void 0,a.backend=void 0,a.ref=void 0,a.backendLink=new Jt((function(e){a.setState(e)}),jn),a.backend=new wn,a.ref=r.a.createRef(),a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){document.body.classList.add("temp"),this.backendLink.resetState()}},{key:"render",value:function(){return r.a.createElement(Nn.Provider,{value:this.state},r.a.createElement(Cn,{backend:this.backend},r.a.createElement(Fn,{backend:this.backend,tabRef:this.ref})))}}]),t}(r.a.PureComponent);function Ln(e,t){return t?Intl.DateTimeFormat("et",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}).format(new Date(1e3*e)):Intl.DateTimeFormat("et").format(new Date(1e3*e))}function Bn(e){return Ln(e,!1)}var Hn=function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e,n))).backendLink=void 0,a.backend=void 0,a.backendLink=new Jt((function(e){a.setState(e)}),jn),a.backend=new wn,a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.backendLink.resetState()}},{key:"render",value:function(){return r.a.createElement(Nn.Provider,{value:this.state},r.a.createElement(zn,{backend:this.backend}))}}]),t}(r.a.PureComponent),zn=function(e){var t=e.backend;Object(G.c)();var a=t.use();if(!a)return r.a.createElement("p",null,"Backend failed, close and reopen window.");var c=a.tRefs(),i=Object(ue.a)(c,1)[0];return r.a.createElement("div",{className:"c-layout"},r.a.createElement("div",{className:"c-layout--full"},r.a.createElement("div",{className:"c-header-bar"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"d-flex justify-content-between align-items-center"},r.a.createElement("header",{role:"banner"},r.a.createElement("h1",{"aria-label":i("tara-head-short"),"aria-hidden":"true"}),r.a.createElement("p",{"aria-label":i("tara-head-title")},i("tara-head-title"))),r.a.createElement("div",null,r.a.createElement(Dn,null))))),r.a.createElement("div",{className:"c-header"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"c-header__logo"},r.a.createElement("div",{className:"c-header__logo-link"},r.a.createElement("img",{src:n(251),"aria-hidden":"true",alt:""}))))),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"c-tab-login"},r.a.createElement("main",{role:"main",className:"c-tab-login__main"},r.a.createElement("div",{className:"c-tab-login__content is-active","data-tab":"mobile-id","aria-hidden":"false"},r.a.createElement("div",{className:"c-tab-login__content-wrap"},r.a.createElement("div",{className:"c-tab-login__content-icon"},r.a.createElement("svg",{role:"img","aria-label":"",className:"icon icon-mobile-id"},r.a.createElement("use",{href:"#icon-mobile-id"}))),r.a.createElement("div",{className:"c-tab-login__content-text"},r.a.createElement("div",{role:"heading"},r.a.createElement("h2",null,i("tara-mobile-id"))),r.a.createElement("p",null,i("tara-mobile-id-explained")),r.a.createElement("form",null,r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"col-label"},r.a.createElement("label",{htmlFor:"mid-personal-code",className:"form-label"},i("tara-personal-code"))),r.a.createElement("td",null,r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},"EE")),r.a.createElement("input",{type:"text",id:"mid-personal-code",className:"form-control",name:"principalCode",defaultValue:"47302200234"})))),r.a.createElement("tr",null,r.a.createElement("td",{className:"col-label"},r.a.createElement("label",{htmlFor:"mid-phone-number",className:"form-label"},i("tara-phone-number"))),r.a.createElement("td",null,r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},"+372")),r.a.createElement("input",{type:"tel",id:"mid-phone-number",className:"form-control",name:"mobileNumber",defaultValue:"53883333"})))),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",null,r.a.createElement("button",{className:"c-btn c-btn--primary",onClick:function(e){return function(e){e.preventDefault(),a.login(e,e.currentTarget.form.elements[0].value),window.location.href="../csui/"}(e)}},i("tara-continue"))))))))),r.a.createElement("div",{className:"c-tab-login__footer"},r.a.createElement("p",null,r.a.createElement("a",{href:"https://tim.www.eesti.ee/tim/cancel-auth"},i("tara-return"))),r.a.createElement("p",null,r.a.createElement("a",{href:"https://www.id.ee/?id=35803&group_id=1",target:"_blank",rel:"noopener noreferrer"},i("tara-help")))))))),r.a.createElement("p",{className:"link-back-mobile"},r.a.createElement("a",{href:"https://tim.www.eesti.ee/tim/cancel-auth"},i("tara-return"))),r.a.createElement("svg",{"aria-hidden":"true",className:"c-inline-svg__hidden",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("defs",null,r.a.createElement("symbol",{id:"icon-mobile-id",viewBox:"0 0 20 32"},r.a.createElement("title",null,"mobile-id"),r.a.createElement("path",{d:"M7.218 28.027h5.476v1.12h-5.476zM15.876 31.68h-12.089c-0 0-0 0-0 0-1.8 0-3.261-1.454-3.271-3.252v-24.854c0.005-1.803 1.468-3.262 3.271-3.262 0 0 0 0 0 0h12.089c0 0 0 0 0 0 1.803 0 3.266 1.459 3.271 3.262v24.845c-0.005 1.803-1.468 3.262-3.271 3.262 0 0 0 0 0 0v0zM3.787 1.422c0 0 0 0-0 0-1.19 0-2.155 0.962-2.16 2.151v22.045h16.409v-22.044c0 0 0 0 0-0 0-1.188-0.963-2.151-2.151-2.151-0.003 0-0.006 0-0.009 0h0zM1.627 28.418c0.005 1.189 0.97 2.151 2.16 2.151 0 0 0 0 0 0h12.089c0 0 0 0 0 0 1.19 0 2.155-0.962 2.16-2.151v-1.689h-16.409zM12.382 8.951c-0.721-0.218-1.55-0.343-2.408-0.343-0.544 0-1.076 0.050-1.592 0.147l0.053-0.008c-0.018 0.004-0.039 0.006-0.060 0.006-0.154 0-0.282-0.108-0.313-0.252l-0-0.002c-0.009-0.089 0-0.169 0.053-0.231 0.047-0.068 0.119-0.117 0.202-0.133l0.002-0c0.494-0.094 1.063-0.147 1.644-0.147 0.922 0 1.813 0.135 2.653 0.386l-0.065-0.017c0.132 0.040 0.226 0.16 0.226 0.302 0 0.174-0.141 0.315-0.315 0.315-0.032 0-0.062-0.005-0.091-0.013l0.002 0.001zM14.187 11.396c-0 0-0.001 0-0.001 0-0.066 0-0.127-0.020-0.178-0.054l0.001 0.001c-1.129-0.791-2.531-1.263-4.043-1.263-1.375 0-2.659 0.391-3.747 1.067l0.030-0.017c-0.049 0.032-0.109 0.051-0.174 0.051-0.113 0-0.213-0.059-0.27-0.148l-0.001-0.001c-0.033-0.049-0.053-0.108-0.053-0.173 0-0.116 0.064-0.217 0.158-0.271l0.002-0.001c1.151-0.716 2.547-1.141 4.043-1.141 1.65 0 3.18 0.517 4.435 1.397l-0.025-0.016c0.142 0.089 0.178 0.293 0.089 0.436-0.059 0.081-0.153 0.133-0.26 0.133-0.002 0-0.005-0-0.007-0h0zM5.236 13.92c-0.176-0.001-0.318-0.144-0.318-0.32 0-0.070 0.023-0.135 0.061-0.188l-0.001 0.001c1.147-1.527 2.954-2.505 4.99-2.505 1.961 0 3.709 0.907 4.85 2.324l0.009 0.012c0.107 0.142 0.089 0.338-0.053 0.444-0.053 0.041-0.121 0.066-0.195 0.066-0.101 0-0.19-0.046-0.249-0.119l-0-0.001c-1.035-1.279-2.604-2.090-4.364-2.090-1.826 0-3.448 0.874-4.471 2.227l-0.010 0.014c-0.057 0.078-0.146 0.13-0.248 0.133l-0.001 0zM5.556 17.138c-0.003 0-0.006 0-0.009 0-0.172 0-0.311-0.139-0.311-0.311 0-0 0-0 0-0v0-0.018c0.161-2.486 2.216-4.441 4.728-4.441 2.137 0 3.943 1.415 4.534 3.358l0.009 0.034c0.004 0.018 0.006 0.039 0.006 0.061 0 0.177-0.143 0.32-0.32 0.32-0.128 0-0.238-0.075-0.289-0.183l-0.001-0.002v-0.018c-0.511-1.722-2.079-2.956-3.936-2.956-2.181 0-3.963 1.703-4.091 3.852l-0.001 0.011c-0.010 0.164-0.145 0.293-0.311 0.293-0.003 0-0.007-0-0.010-0h0zM7.004 19.387c-0.176-0-0.319-0.144-0.319-0.32 0-0.025 0.003-0.050 0.008-0.073l-0 0.002c0.082-0.236 0.129-0.507 0.129-0.79 0-0.116-0.008-0.231-0.023-0.343l0.001 0.013c-0.085-0.277-0.134-0.596-0.134-0.926 0-1.802 1.461-3.262 3.262-3.262 1.579 0 2.896 1.122 3.197 2.612l0.004 0.021c0.142 0.587 0.213 1.182 0.204 1.778 0 0.178-0.142 0.32-0.32 0.32-0.17-0.005-0.306-0.141-0.311-0.311v-0c0-0.551-0.062-1.102-0.178-1.636-0.291-1.16-1.325-2.005-2.556-2.005-1.453 0-2.631 1.178-2.631 2.631 0 0.222 0.028 0.439 0.080 0.645l-0.004-0.018c0.080 0.329 0.044 0.809-0.107 1.422-0.036 0.137-0.157 0.236-0.302 0.24h-0zM8.311 20.151l-0.089-0.009c-0.128-0.041-0.219-0.158-0.219-0.297 0-0.034 0.005-0.066 0.015-0.096l-0.001 0.002c0.169-0.456 0.266-0.982 0.266-1.531 0-0.244-0.019-0.483-0.056-0.717l0.003 0.026c-0.059-0.17-0.093-0.367-0.093-0.571 0-0.992 0.804-1.796 1.796-1.796 0.892 0 1.632 0.65 1.772 1.503l0.001 0.010c0.213 0.836 0.222 1.804 0.027 2.88-0.001 0.176-0.144 0.319-0.32 0.319s-0.32-0.143-0.32-0.32c0-0.038 0.007-0.074 0.018-0.107l-0.001 0.002c0.178-0.987 0.169-1.867-0.018-2.631-0.128-0.51-0.583-0.882-1.124-0.882-0.639 0-1.158 0.518-1.158 1.158 0 0.098 0.012 0.193 0.035 0.284l-0.002-0.008c0.16 0.64 0.089 1.502-0.222 2.56-0.043 0.13-0.163 0.222-0.305 0.222-0.002 0-0.005-0-0.007-0h0zM9.804 20.329c-0.172-0.005-0.31-0.147-0.31-0.32 0-0.025 0.003-0.050 0.008-0.073l-0 0.002c0.159-0.552 0.256-1.187 0.267-1.843l0-0.006c0-0.311-0.036-0.622-0.107-0.916-0.001-0.008-0.001-0.017-0.001-0.026 0-0.177 0.143-0.32 0.32-0.32 0.131 0 0.244 0.079 0.294 0.192l0.001 0.002c0.089 0.356 0.124 0.711 0.116 1.067-0.010 0.716-0.113 1.403-0.298 2.056l0.014-0.056c-0.036 0.137-0.157 0.236-0.302 0.24h-0z"}))))))},Kn=function(e){var t=Object(a.useState)(!window.localStorage.getItem("arena-explained-"+e.arena)),n=Object(ue.a)(t,2),c=n[0],i=n[1],s=function(t){t&&t.preventDefault(),window.localStorage.setItem("arena-explained-"+e.arena,"true"),i(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(me.a,{show:c,onHide:s,size:"lg"},r.a.createElement(me.a.Body,null,r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.t(e.arena+".arena-explained")}})),r.a.createElement(me.a.Footer,null,r.a.createElement(de.a,{variant:"secondary",onClick:s},e.t("close")))),r.a.createElement(de.a,{className:"btn badge mx-2",variant:"secondary",title:"Reopen explainer / ava seletav tekst uuesti",onClick:function(e){e.preventDefault(),i(!0)}},"?"))},Jn=function(){var e=Object(G.c)().t,t=Object(s.c)().getState().theatre;return r.a.createElement("div",{className:"App"},r.a.createElement(o.a,{basename:"."},r.a.createElement(l.c,null,r.a.createElement(l.a,{path:"(.*)/ui/ria"},r.a.createElement(Hn,null)),r.a.createElement(l.a,{path:"(.*)/ui/csui"},r.a.createElement(qn,null)),r.a.createElement(l.a,{path:"/"},r.a.createElement("nav",{className:"navbar navbar-light bg-light mb-4"},r.a.createElement("span",{className:"navbar-brand"},r.a.createElement("img",{alt:"logo",src:n(253),width:"30"})),r.a.createElement("span",null,r.a.createElement(yn,{arenaNames:t.arenas.allNames})),r.a.createElement("div",{className:"w-auto"},r.a.createElement(Dn,null),r.a.createElement(Kn,{arena:t.active,t:e}))),r.a.createElement("div",{className:"container-fluid"},r.a.createElement(bn,null))))))},Gn=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("div",null,"loading..."))},Wn=function(){return r.a.createElement(a.Suspense,{fallback:r.a.createElement(Gn,null)},r.a.createElement(Jn,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Qn=n(44),$n=n(143),Xn=n(144),Yn=Object(Qn.combineReducers)({theatre:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:un(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case vn:return dn({},e,{active:t.arena});default:return dn({},e,{arenas:T(e.arenas,(function(e){return L(e,t)}))})}}});var Zn=function(){var e=[$n.a],t=Qn.applyMiddleware.apply(void 0,e),n=Object(Qn.createStore)(Yn,Object(Xn.composeWithDevTools)(t));return n.subscribe((function(){return H(n)})),function(e){window.addEventListener("message",(function(t){if(t.data.type===Bt){var n=t.data.target.split(" - "),a=Object(ue.a)(n,2),r=a[0],c=a[1],i=t.data.url;void 0===Kt.find((function(e){return e.arena===r&&e.process===c&&e.ui===t.source}))&&(console.log("Unregistered childwindow, registering: ",t.data),Kt.push(new zt(r,c,e,i,t.source).registerListeners().stateChanged()),t.preventDefault())}}))}(n),n}();i.a.render(r.a.createElement(s.a,{store:Zn},r.a.createElement(Wn,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},90:function(e,t,n){}},[[145,1,2]]]);
//# sourceMappingURL=main.ab12dcbf.chunk.js.map